<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>XDISPLAY</title>

  <!-- ÎÎ­Î± Î³ÏÎ±Î¼Î¼Î±Ï„Î¿ÏƒÎµÎ¹ÏÎ¬ -->
   <link rel="preconnect" href="https://script.google.com">
<link rel="dns-prefetch" href="https://script.google.com">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
<link rel="preload" as="image" href="https://i.postimg.cc/Y9HZXm3q/f26ceef4-3445-4c9a-a15d-64ea3cac2a95-removalai-preview.png">
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>

<!-- Firestore -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
  // Î’Î¬Î»Îµ ÎµÎ´Ï Ï„Î¿ config Î±Ï€ÏŒ Ï„Î¿ Firebase Console > Project settings > Your apps > Web app
const firebaseConfig = {
  apiKey: "AIzaSyBcwXllrv82qw6o7FCwgJL2_qNGheLNit0",
  authDomain: "xgym-b5623.firebaseapp.com",
  projectId: "xgym-b5623",
  storageBucket: "xgym-b5623.appspot.com" ,
  messagingSenderId: "269441169531",
  appId: "1:269441169531:web:e1f0fecf96b0fb7cf4cade",
  measurementId: "G-P526QEKJKW"
};


  // Î•ÎºÎºÎ¯Î½Î·ÏƒÎ· Firebase
  firebase.initializeApp(firebaseConfig);

  // Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Î±Î½Ï„Î¹ÎºÎµÎ¹Î¼Î­Î½Î¿Ï… Firestore
  const db = firebase.firestore();
let lastSeenTs = 0;
let skipFirst = true;

function startScanSignalListener() {
  return db.collection("signals").doc("lastScan").onSnapshot((doc) => {
    if (!doc.exists) return;
    const data = doc.data() || {};
    const tsMillis = (data.ts && data.ts.toMillis) ? data.ts.toMillis() : Date.now();

    // â›³ Î±Î³Î½ÏŒÎ·ÏƒÎµ Ï„Î¿ Î±ÏÏ‡Î¹ÎºÏŒ snapshot ÏƒÏ„Î¿ page load
    if (skipFirst) {
      skipFirst = false;
      lastSeenTs = tsMillis; // ÏƒÏ…Î³Ï‡ÏÎ¿Î½Î¹ÏƒÎ¼ÏŒÏ‚ Î³Î¹Î± Î½Î± Î¼Î· Î¸ÎµÏ‰ÏÎ·Î¸ÎµÎ¯ â€œÎ½Î­Î¿â€
      return;
    }

    if (tsMillis <= lastSeenTs) return;
    lastSeenTs = tsMillis;

    const id = (data.id || "").toString().trim();
    if (!id) return;

    checkSubscriptionForId(id);
  }, (err) => console.error("signals/lastScan listener error:", err));
}


// ÎœÎ¹ÎºÏÏŒ wrapper Î³Î¹Î± Î½Î± Ï€ÎµÏÎ¬ÏƒÎ¿Ï…Î¼Îµ id (ÎºÎ±Î¹ Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬ ÏŒÎ½Î¿Î¼Î±)
async function checkSubscriptionForId(scannedId) {
  if (!scannedId) return;
  const loading = showLoadingPopup();
  try {
    const res = await fetch(
      "https://script.google.com/macros/s/AKfycbzxFrrfTz9LGux2WxNJGdxAabKC5ca9fPNSYNLTejyMrVn2qCljaFb4_nPoNmSrE1TzUQ/exec?id=" + encodeURIComponent(scannedId),
      { cache: "no-store" }
    );
    const data = await res.json();
    hideLoadingPopup();

    // âœ… Î Î‘ÎÎ¤Î‘ Î±Ï€ÏŒ Ï„Î¿ Sheet:
    const sheetName = String(data.name || "").trim();

    // Î‘Î½ Î¸ÎµÏ‚ ÎœÎŸÎÎŸ Î¼Î¹ÎºÏÏŒ ÏŒÎ½Î¿Î¼Î± Î±Ï€ÏŒ Ï„Î¿ Sheet:
    const firstOnly = sheetName.split(/\s+/)[0] || "";

    // ğŸ‘‰ Î”Î¹Î¬Î»ÎµÎ¾Îµ: Î±) Î±ÎºÏÎ¹Î²ÏÏ‚ ÏŒÏ€Ï‰Ï‚ ÏƒÏ„Î¿ Sheet
    const displayName = firstOnly;



    showPopup(displayName, !!data.active);
  } catch (e) {
    console.error(e);
    hideLoadingPopup();
    showPopup("Î£Ï†Î¬Î»Î¼Î±", false);
  }
}
  db.settings({
    experimentalForceLongPolling: true,
    useFetchStreams: false
  });
function todayEL() {
    return new Date().toLocaleDateString('el-GR');
  }
</script>
 <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }

    html, body {
      height: 100%;
      overflow: hidden;
      background: black;
    }

    .slideshow-container {
      position: fixed;
      width: 100%;
      height: 100%;
        margin: 0;
  padding: 0;
    }

    .slide {
  position: absolute;
  left: 0; right: 0; top: 0; bottom: 0;  /* ğŸ‘ˆ Ï€ÏÏŒÏƒÎ¸ÎµÏƒÎµ Î±Ï…Ï„Î¬ */
  width: 100%;
  height: 100%;
  margin: 0; padding: 0;                  /* ğŸ‘ˆ ÏƒÎ¹Î³Î¿Ï…ÏÎ¹Î¬ */
  background-size: cover;
  background-position: center;
  opacity: 0;
  transition: opacity 2s ease-in-out;
}

    .slide.active {
      opacity: 1;
      z-index: 1;
    }

    .status-icon {
      width: 4vw;
      height: 4vw;
      vertical-align: middle;
      margin-left: 1vw;
    }
    .slide.portrait {
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  display: flex;
  align-items: center;
  justify-content: center;
}

.slide.portrait .overlay {
  position: absolute;
  width: 100%;
  height: 100%;
  backdrop-filter: blur(6px);
  background: rgba(0, 0, 0, 0.4); /* Î´Î¹Î±Ï†Î¬Î½ÎµÎ¹Î± + ÏƒÎºÎ¿Ï„ÎµÎ¯Î½Î¹Î±ÏƒÎ¼Î± */
  z-index: 0;
}
#digitalClock {
  position: fixed;
  top: 1.5vh;
  left: 2vw;
  font-size: 4vw;
  font-family: 'Orbitron', sans-serif;
  color: #00ffff;
  background: rgba(0, 0, 0, 0.25);
  padding: 0.5vh 1vw;
  border-radius: 12px;
  z-index: 9999;
  text-shadow: 0 0 5px #00ffff, 0 0 6px #00ffff;
  box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
  backdrop-filter: blur(4px);
  letter-spacing: 0.1em;

  transition: opacity 0.6s ease-in-out, transform 0.6s ease-in-out;
  opacity: 1;
  transform: translateY(0);
}

/* ÎŒÏ„Î±Î½ Î¸Î­Î»Î¿Ï…Î¼Îµ Î½Î± Ï„Î¿ ÎºÏÏÏˆÎ¿Ï…Î¼Îµ */
#digitalClock.hidden {
  opacity: 0;
  transform: translateY(-20px);
  pointer-events: none;
}

/* ÎŒÏ„Î±Î½ Î¸Î­Î»Î¿Ï…Î¼Îµ Î½Î± Ï„Î¿ ÎµÎ¼Ï†Î±Î½Î¯ÏƒÎ¿Ï…Î¼Îµ */
#digitalClock.visible {
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}


/* === ÎšÎµÎ¯Î¼ÎµÎ½Î± popup Î¼Îµ neon glow === */
.popup-line {
  font-family: 'Orbitron', sans-serif;
  font-size: 4.5vw;
  font-weight: 500;
  margin-bottom: 1.5vh;
  color: white;
}

.popup-line.active {
  color: #96e6a1;
  text-shadow: 0 0 1px #00ff88, 0 0 4px #00ff88, 0 0 15px #00ff88;
}

.popup-line.inactive {
  color: #ff7f7f;
  text-shadow: 0 0 1px #ff0040, 0 0 4px #ff0040, 0 0 15px #ff0040;
}
/* === Fancy POPUP v2 === */
@keyframes popIn {
  0%   { opacity: 0; transform: scale(.7); }
  60%  { opacity: 1; transform: scale(1.05); }
  100% { transform: scale(1); }
}
@keyframes neonPulse {
  0%,100% { text-shadow: 0 0 6px rgba(0,255,170,.8), 0 0 18px rgba(0,255,170,.35); }
  50% { text-shadow: 0 0 10px rgba(0,255,170,1), 0 0 26px rgba(0,255,170,.6); }
}
@keyframes neonPulseRed {
  0%,100% { text-shadow: 0 0 6px rgba(255,70,100,.9), 0 0 18px rgba(255,70,100,.4); }
  50% { text-shadow: 0 0 10px rgba(255,70,100,1), 0 0 26px rgba(255,70,100,.7); }
}
@keyframes ringSpin {
  0% { transform: rotate(0deg); opacity:.85; }
  50% { opacity:1; }
  100% { transform: rotate(360deg); opacity:.85; }
}
@keyframes shimmer {
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}
#popup-overlay {
  position: fixed; inset: 0; z-index: 9999;
  display: flex; align-items: center; justify-content: center;
  backdrop-filter: blur(4px);
-webkit-backdrop-filter: blur(4px);
  background: radial-gradient(1200px 800px at 50% 50%, rgba(0,255,200,.08), rgba(0,0,0,.85) 40%);
  animation: fadeBg .4s ease;
}
@keyframes fadeBg { from {opacity:0} to {opacity:1} }

.popup-card {
  position: relative;
  width: min(82vw, 900px);
  padding: 5vh 5vw;
  border-radius: 22px;
  background: rgba(0,0,0,.65);
  border: 1px solid rgba(255,255,255,.08);
  box-shadow: 0 10px 60px rgba(0,255,190,.25), inset 0 0 40px rgba(255,255,255,.02);
  animation: popIn .6s cubic-bezier(.17,.97,.37,1);
  overflow: hidden;
  will-change: transform, opacity;
transform: translateZ(0);
contain: paint;
}

.popup-card::before, .popup-card::after {
  content:""; position:absolute; inset:-40%;
  border-radius: 50%;
  border: 2px solid rgba(0,255,200,.35);
  filter: blur(2px);
  animation: ringSpin 12s linear infinite;
  animation-delay: .45s;
}
.popup-card::after {
  border-color: rgba(0,170,255,.28);
  animation-duration: 18s;
  mix-blend-mode: screen;
  animation-delay: .55s;
}
.popup-card.active {
  /* Ï€ÏÎ¬ÏƒÎ¹Î½Î¿-ÎºÏ…Î±Î½ÏŒ glow (ÏŒÏ€Ï‰Ï‚ ÎµÎ¯Ï‡ÎµÏ‚) */
  border-color: rgba(0,255,200,.28);
  box-shadow: 0 10px 60px rgba(0,255,190,.25), inset 0 0 40px rgba(255,255,255,.02);
}

.popup-card.inactive {
  /* ÎšÎŸÎšÎšÎ™ÎÎŸ Ï€ÎµÏÎ¯Î³ÏÎ±Î¼Î¼Î± + ÎºÏŒÎºÎºÎ¹Î½Î¿ ÎµÎ¾Ï‰Ï„ÎµÏÎ¹ÎºÏŒ glow */
  border-color: rgba(255,70,100,.35);
  box-shadow: 0 10px 60px rgba(255,70,100,.25), inset 0 0 40px rgba(255,255,255,.02);
}

/* Animated Î´Î±Ï‡Ï„ÏÎ»Î¹Î¿Î¹ (Î¿Î¹ Ï€ÏÎ¹Î½/Î¼ÎµÏ„Î¬) */
.popup-card.active::before,
.popup-card.active::after {
  border-color: rgba(0,255,200,.35);
}
.popup-card.active::after {
  border-color: rgba(0,170,255,.28); /* Î´ÎµÏÏ„ÎµÏÎ¿Ï‚ Î´Î±ÎºÏ„ÏÎ»Î¹Î¿Ï‚ Ï€Î¹Î¿ ÎºÏ…Î±Î½ÏŒÏ‚ */
}

/* â›” Inactive: ÎšÎŸÎšÎšÎ™ÎÎŸÎ™ ÎºÎ±Î¹ Î¿Î¹ Î´ÏÎ¿ Î´Î±Ï‡Ï„ÏÎ»Î¹Î¿Î¹ */
.popup-card.inactive::before,
.popup-card.inactive::after {
  border-color: rgba(255,70,100,.35);
}

/* Hover wipe Ï‡ÏÏÎ¼Î± Î±Î½Î¬ state */
.popup-card.active .close-wipe {
  background: radial-gradient(200px 200px at var(--x,50%) var(--y,50%), rgba(0,255,150,.10), transparent 60%);
}
.popup-card.inactive .close-wipe {
  background: radial-gradient(200px 200px at var(--x,50%) var(--y,50%), rgba(255,70,100,.10), transparent 60%);
}

/* Î ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬: ÎºÎ±Î¹ Ï„Î¿ overlay Î½Î± Î­Ï‡ÎµÎ¹ ÎµÎ»Î±Ï†ÏÏ tint Î±Î½Î¬ state */
#popup-overlay.active {
  background: radial-gradient(1200px 800px at 50% 50%, rgba(0,255,200,.08), rgba(0,0,0,.85) 40%);
}
#popup-overlay.inactive {
  background: radial-gradient(1200px 800px at 50% 50%, rgba(255,70,100,.08), rgba(0,0,0,.85) 40%);
}

.popup-title {
  font-family: 'Orbitron', sans-serif;
  font-size: clamp(32px, 6vw, 72px);
  letter-spacing: .02em;
  margin: 0 0 1.2vh 0;
  line-height: 1.05;
  background: linear-gradient(90deg, #fff, #89ffe6, #00ffb0, #ffffff);
  -webkit-background-clip: text; background-clip: text; color: transparent;
  background-size: 200% 100%;
  animation: shimmer 2.5s linear infinite;
}
.popup-title.active {
  position: relative;
  z-index: 2;
  animation: shimmer 2.5s linear infinite, neonPulse 1.6s ease-in-out infinite;
}
.popup-title.inactive {
  position: relative;
  z-index: 2;
  background: linear-gradient(90deg, #fff, #ff8ca5, #ff4664, #ffffff);
  -webkit-background-clip: text;
  background-clip: text;
  color: transparent;
  animation: shimmer 2.5s linear infinite, neonPulseRed 1.6s ease-in-out infinite;
}

.popup-line {
  font-family: 'Poppins', sans-serif;
  font-size: clamp(18px, 3.3vw, 34px);
  color: #e9fffb; opacity: 0; transform: translateY(10px);
  margin: .6vh 0;
  transition: opacity .5s, transform .5s;
}
.popup-line.show { opacity: 1; transform: translateY(0); }
.popup-line b { font-weight: 700; }

.badge {
  display:inline-flex; align-items:center; gap:.6rem;
  padding:.5rem 1rem; border-radius:999px;
  font-size: clamp(14px, 2.4vw, 22px);
  margin-top:1vh;
  backdrop-filter: blur(3px);
}
.badge.active { color:#0d1; background: rgba(0,255,150,.12); border:1px solid rgba(0,255,150,.35); }
.badge.inactive { color:#f66; background: rgba(255,70,100,.12); border:1px solid rgba(255,70,100,.35); }

.close-wipe {
  position:absolute; inset:-2px; border-radius: inherit;
  pointer-events:none; opacity:0;
  background: radial-gradient(200px 200px at var(--x,50%) var(--y,50%), rgba(255,255,255,.06), transparent 60%);
  transition: opacity .4s;
}
.popup-card:hover .close-wipe { opacity:1; }
/* Î‘Ï†Î±Î¹ÏÎµÎ¯ Ï„Î¿ glow ÎºÎ±Î¹ ÎºÏÎ±Ï„Î¬ Î»ÎµÏ…ÎºÏŒ Ï‡ÏÏÎ¼Î± Î¼ÏŒÎ½Î¿ Î³Î¹Î± Ï„Î¹Ï‚ ÏƒÎµÎ¹ÏÎ­Ï‚ ÎºÎµÎ¹Î¼Î­Î½Î¿Ï… */
.popup-line {
  color: #ffffff !important;
  text-shadow: none !important;
}

/* ===== Loading Popup (glass + neon ring) ===== */
#popup-loading {
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(0,0,0,.78);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  z-index: 9999;
  opacity: 0;
  animation: loadingFadeIn .35s ease forwards;
}

.loading-card {
  position: relative;
  width: min(80vw, 680px);
  padding: min(4vh, 40px) min(4vw, 40px);
  border-radius: 22px;
  background: rgba(10, 14, 22, .65);
  box-shadow: 0 10px 40px rgba(0,0,0,.5), inset 0 0 0 1px rgba(255,255,255,.06);
  overflow: hidden;
  transform: translateY(10px) scale(.98);
  animation: cardLift .5s cubic-bezier(.2,.8,.2,1) .1s forwards;
}

/* Neon spinning ring border */
.loading-card::before {
  content: "";
  position: absolute;
  inset: -2px;
  border-radius: 24px;
  background: conic-gradient(from 0deg, #00f0ff, #74f2ce, #00ffa3, #00f0ff);
  filter: blur(6px) saturate(1.2);
  animation: spin 2.4s linear infinite;
  mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask:
    linear-gradient(#000 0 0) content-box,
    linear-gradient(#000 0 0);
  padding: 2px;
  -webkit-mask-composite: xor;
          mask-composite: exclude;
  opacity: .55;
}

/* Inner glass layer */
.loading-inner {
  position: relative;
  z-index: 1;
}

/* Title + dots */
.loading-title {
  font-family: 'Orbitron', sans-serif;
  font-size: clamp(22px, 4.2vw, 40px);
  color: #eaffff;
  text-align: center;
  letter-spacing: .06em;
  margin: 0 0 .6em;
  text-shadow: 0 0 6px rgba(0,255,214,.45);
  animation: glowPulse 1.6s ease-in-out infinite;
}

/* Sub text */
.loading-sub {
  font-size: clamp(14px, 2.2vw, 18px);
  color: rgba(255,255,255,.8);
  text-align: center;
  margin-bottom: 1.2em;
}

/* Progress bar with shimmer */
.loading-progress {
  height: 12px;
  width: 100%;
  border-radius: 999px;
  background: rgba(255,255,255,.08);
  overflow: hidden;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
}
.loading-bar {
  height: 100%;
  width: 0%;
  border-radius: inherit;
  background: linear-gradient(90deg, rgba(0,255,214,.2), rgba(0,255,214,.9), rgba(0,255,214,.2));
  animation: sweep 2.2s ease-in-out infinite, shimmer 1.2s linear infinite;
}

/* Keyframes */
@keyframes loadingFadeIn {
  to { opacity: 1; }
}
@keyframes cardLift {
  to { transform: translateY(0) scale(1); }
}
@keyframes spin {
  to { transform: rotate(360deg); }
}
@keyframes glowPulse {
  0%,100% { text-shadow: 0 0 6px rgba(0,255,214,.35); }
  50% { text-shadow: 0 0 14px rgba(0,255,214,.75); }
}

@keyframes sweep {
  0%   { width: 0%; }
  50%  { width: 78%; }
  100% { width: 100%; }
}
@keyframes shimmer {
  0% { filter: brightness(1); }
  50% { filter: brightness(1.35); }
  100% { filter: brightness(1); }
}

/* Out animation */
#popup-loading.hide {
  opacity: 0;
  transition: opacity .3s ease;
}
/* Î›Î¿Î³ÏŒÏ„Ï…Ï€Î¿ Î»Î¹Î¿Î½Ï„Î±ÏÎ¹Î¿Ï ÏƒÏ„Î¿ popup */
.holo-logo {
  width: clamp(60px, 14vw, 110px);
  height: clamp(60px, 14vw, 110px);
  border-radius: 50%;
  overflow: hidden;
  margin: 0 auto 1em;
  border: 3px solid #00ffd5;
  box-shadow: 0 0 15px rgba(0,255,214,.6), inset 0 0 12px rgba(0,255,214,.4);
  animation: logoPulse 2.8s ease-in-out infinite, logoRotate 12s linear infinite;
}

.holo-logo img {
  width: 100%;
  height: 100%;
  object-fit: contain;  /* ğŸ‘ˆ Î±Î½Ï„Î¯ Î³Î¹Î± cover Î³Î¹Î± Ï€Î¹Î¿ â€œÎ¾Îµ-Î¶Î¿Ï…Î¼Î±ÏÎ¹ÏƒÎ¼Î­Î½Î¿â€ */
  background-color: #000; /* Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ Î³Î¹Î± Î½Î± Î³ÎµÎ¼Î¯Î¶ÎµÎ¹ Î³ÏÏÏ‰ Î³ÏÏÏ‰ */
  padding: 6%; /* Î»Î¯Î³Î¿ â€œÎ¼Î±Î¾Î¹Î»Î¬ÏÎ¹â€ Î³ÏÏÏ‰ Î±Ï€ÏŒ Ï„Î¿ Î»Î¹Î¿Î½Ï„Î¬ÏÎ¹ */
  box-sizing: border-box;
}

/* Keyframes Î³Î¹Î± logo */
@keyframes logoPulse {
  0%,100% { box-shadow: 0 0 15px rgba(0,255,214,.6), inset 0 0 12px rgba(0,255,214,.4); }
  50%     { box-shadow: 0 0 25px rgba(0,255,214,.9), inset 0 0 20px rgba(0,255,214,.6); }
}

@keyframes logoRotate {
  from { transform: rotate(0deg); }
  to   { transform: rotate(360deg); }
}
/* ============ XDISPLAY â€¢ Neo Leaderboard ============ */
/* ÎŸÎ›Î‘ Î½Î­Î± prefixes Î³Î¹Î± Î½Î± Î¼Î·Î½ â€œÏ€Î¹Î¬Î½Î¿Ï…Î½â€ Ï„Î± Ï€Î±Î»Î¹Î¬: xlb- */

:root{
  --xlb-bg:#0c1118;
  --xlb-panel:#121a24;
  --xlb-ink:#eaf6ff;
  --xlb-muted:rgba(234,246,255,0.64);
  --xlb-glow:#57ffd6;
  --xlb-accent:#5ff0ff;
  --xlb-accent-2:#9bf7c9;
  --xlb-gold:#ffd166;
  --xlb-silver:#d6e4f0;
  --xlb-bronze:#c68b59;
}
/* full viewport Î³Î¹Î± Ï„Î¿ container & ÎºÎ¬Î¸Îµ slide */
.slideshow-container,
.slide {
  height: 100vh;
  width: 100vw;          /* Î½Î­Î¿ */
  margin: 0;
  padding: 0;
}

/* ÏƒÏ„Î±Î¸ÎµÏÏŒ ÎºÎ¬Î¸ÎµÏ„Î¿ padding Î³Î¹Î± Ï„Î· leaderboard slide (px Î³Î¹Î± TV/cast) */
:root { --slide-vpad: 12px; }

/* slide wrapper */
.xlb-slide{
  width: 100vw;          /* Î½Î­Î¿ */
  height: 100vh;         /* Î®Î´Î· Ï…Ï€Î¬ÏÏ‡ÎµÎ¹, ÎºÏÎ±Ï„Î¬Î¼Îµ */
  padding: 0;            /* Î±Ï€ÏŒ 2vh 0 -> 0 Î³Î¹Î± edgeâ€‘toâ€‘edge */
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  overflow: hidden;
  background: radial-gradient(1200px 800px at 50% 50%, rgba(95,240,255,.08), var(--xlb-bg) 45%);
}

/* animated pulse lines background (Î±Î½Ï„Î¯ Î³Î¹Î± Ï€ÎµÏÎ¹ÏƒÏ„ÏÎµÏ†ÏŒÎ¼ÎµÎ½Î¿ Ï„ÎµÏ„ÏÎ¬Î³Ï‰Î½Î¿) */

@keyframes xlbSweep {
  0% { background-position: 0 0; }
  100% { background-position: 800px 0; }
}

/* ÎºÎµÎ½Ï„ÏÎ¹ÎºÏŒ panel */
.xlb-panel{
  width: 100%;
  height: 100%;          /* Î½Î­Î¿: Î³ÎµÎ¼Î¯Î¶ÎµÎ¹ ÎºÎ±Ï„Î±ÎºÏŒÏÏ…Ï†Î± */
  max-width: none;
  box-sizing: border-box;
  background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
  border: 1px solid rgba(255,255,255,.08);
  border-radius: 0;
  box-shadow: 0 10px 40px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.04);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  position: relative;
  overflow: hidden;       /* Î¾Î±Î½Î¬ ÏƒÎµ hidden Î³Î¹Î± Î½Î± â€œÎºÎ¬Î¸ÎµÏ„Î±Î¹â€ */
  display: flex;
  flex-direction: column; /* header + list */
  transform: none;        /* Î½Î± ÎœÎ—Î½ ÎºÎ¬Î½ÎµÎ¹ scale */
  transform-origin: top center;
  margin: 0;
}

/* Î»ÎµÏ€Ï„ÏŒ neon frame (Ï€Î¿Î»Ï Ï€Î¹Î¿ Î´Î¹Î±ÎºÏÎ¹Ï„Î¹ÎºÏŒ) */
.xlb-panel::before{
  content:"";
  position:absolute; inset:0; pointer-events:none;
  border-radius:inherit;
  padding:1px;
  background: conic-gradient(from 0deg, var(--xlb-accent), var(--xlb-accent-2), var(--xlb-accent));
  -webkit-mask:
    linear-gradient(#000 0 0) content-box,
    linear-gradient(#000 0 0);
  mask:
    linear-gradient(#000 0 0) content-box,
    linear-gradient(#000 0 0);
  -webkit-mask-composite: xor; mask-composite: exclude;
  opacity:.28;
  filter: blur(2px);
}

.xlb-head{
  padding: clamp(8px, 1.4vh, 18px) clamp(10px, 2vw, 24px) clamp(6px, 1.0vh, 14px);
}
.xlb-kicker{
  font-size: clamp(13px,2vw,29px);
  letter-spacing:.28em;
  text-transform:uppercase;
  color: var(--xlb-muted);
  text-align: center;
}
.xlb-title{
  font-family:'Orbitron',sans-serif;
  font-size: clamp(32px,6vw,75px);
  letter-spacing:.04em;
  color:var(--xlb-ink);
  text-shadow: 0 0 12px rgba(95,240,255,.35);
  margin-top:.2rem;
}
.xlb-underline{
  width: min(70vw, 900px);
  height: clamp(2px, 0.6vh, 6px);
  margin: clamp(6px, 1.0vh, 12px) auto 0;
}
@keyframes xlbUnderline{
  0%,100%{ transform:scaleX(.6); opacity:.7; }
  50%{ transform:scaleX(1); opacity:1; }
}


/* STEP 1: default state ÎŸÎ¡Î‘Î¤ÎŸ */
.xlb-item{
  --pct: 0;
  display: grid;
  grid-template-columns: 88px 80px 1fr max-content; /* rank | avatar | name | count */
  align-items: center;
  column-gap: 24px;
  row-gap: .9rem;

  height: 100%;               /* Î³ÎµÎ¼Î¯Î¶ÎµÎ¹ Ï„Î¿ ÎºÎµÎ»Î¯ Ï„Î¿Ï… grid (1/10 Ï„Î¿Ï… ÏÏˆÎ¿Ï…Ï‚) */
  margin: 0;                  /* ÏŒÏ‡Î¹ extra ÎºÎµÎ½Î¬, Ï„Î± ÎµÎ»Î­Î³Ï‡ÎµÎ¹ Ï„Î¿ grid gap */
  padding: .7rem .9rem;

  background: rgba(255,255,255,.03);
  border: 1px solid rgba(255,255,255,.06);
  border-radius: 16px;
  color: var(--xlb-ink);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.02);

  position: relative;
  overflow: hidden;

  /* default Î¿ÏÎ±Ï„ÏŒ (Ï„Î¿ ÎºÏÏÎ²ÎµÎ¹ Î¼ÏŒÎ½Î¿ Ï„Î¿ :not(.in)) */
  transform: translateY(0);
  opacity: 1;
}

/* ÎšÏÏ…Ï†ÏŒ ÎœÎŸÎÎŸ Ï€ÏÎ¹Î½ Ï€Î¬ÏÎµÎ¹ .in (stagger) â€“ Ï„Î¿ Î­Ï‡Î¿Ï…Î¼Îµ Î®Î´Î· Î±Ï€ÏŒ Ï„Î¿ Ï€ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿ Î²Î®Î¼Î± */
.xlb-item:not(.in){
  transform: translateY(8px);
  opacity: 0;
}
/* row in */
.xlb-item.in{
  animation: xlbRowIn .45s cubic-bezier(.2,.8,.2,1) var(--d, 0ms) forwards;
}
@keyframes xlbRowIn{ to{ transform:translateY(0); opacity:1; } }

/* progress meter (Î»ÎµÏ€Ï„Î® Î³ÏÎ±Î¼Î¼Î® Î¼Îµ sheen) */
/* ğŸ¥‡ default (Ï€ÏÏÏ„Î¿Ï‚ Î® Î¬Î»Î»Î¿Î¹) */
.xlb-item::after {
  content:"";
  position:absolute; left:0; right:0; bottom:0;
  height:5px;
  background: linear-gradient(90deg,
    rgba(95,240,255,.2),
    rgba(95,240,255,.85),
    rgba(155,247,201,.85),
    rgba(95,240,255,.2)
  );
  width: calc(var(--pct) * 1%);
  box-shadow: 0 0 10px rgba(95,240,255,.5);
  transition: width .8s ease-out;
}

/* ğŸ¥ˆ Î‘ÏƒÎ·Î¼Î¯ */
.xlb-item.rank-2::after {
  background: linear-gradient(90deg,
    rgba(192,192,192,.2),
    rgba(192,192,192,.85),
    rgba(230,230,230,.85),
    rgba(192,192,192,.2)
  );
  box-shadow: 0 0 10px rgba(192,192,192,.5);
}

/* ğŸ¥‰ Î§Î¬Î»ÎºÎ¹Î½Î¿ */
.xlb-item.rank-3::after {
  background: linear-gradient(90deg,
    rgba(184,115,51,.2),
    rgba(184,115,51,.85),
    rgba(205,133,63,.85),
    rgba(184,115,51,.2)
  );
  box-shadow: 0 0 10px rgba(184,115,51,.5);
}
/* rank badge â€“ ÎºÏÎºÎ»Î¿Ï‚ Î¼Îµ Î»ÎµÏ€Ï„ÏŒ gradient ring */
.xlb-rank{
  width: clamp(44px, 7vh, 96px);
  height: clamp(44px, 7vh, 96px);
  border-radius:50%;
  display:grid; place-items:center;
  line-height: 1;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.16), rgba(255,255,255,.02));
  border:1px solid rgba(255,255,255,.08);
  position:relative;
  font-weight:800;
  font-size: clamp(30px, 4vh, 50px);
  letter-spacing:.02em;
}
.xlb-rank::before{
  content:"";
  position:absolute; inset:-2px; border-radius:inherit;
  background: conic-gradient(from 0deg, var(--xlb-accent), var(--xlb-accent-2), var(--xlb-accent));
  -webkit-mask:
    linear-gradient(#000 0 0) content-box,
    linear-gradient(#000 0 0);
  mask:
    linear-gradient(#000 0 0) content-box,
    linear-gradient(#000 0 0);
  -webkit-mask-composite: xor; mask-composite: exclude;
  padding:2px; opacity:.35; filter: blur(1px);
}

.xlb-count{
  height: 100%;
  line-height: 1;
  display: flex;
  align-items: center;
  justify-content: center;

  font-weight:800;
  font-size: clamp(30px, 2.6vh, 40px);
  padding: clamp(6px, 1vh, 12px) clamp(10px, 1.4vw, 18px);
  min-width: clamp(56px, 8vh, 120px);
  white-space: nowrap;

  color: var(--xlb-ink);
  background: rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.16);
  border-radius:18px;
}

/* Top 3 styles */
.xlb-item.gold   .xlb-rank{ color:var(--xlb-gold); }
.xlb-item.silver .xlb-rank{ color:var(--xlb-silver); }
.xlb-item.bronze .xlb-rank{ color:var(--xlb-bronze); }


/* rank-up effect (Ï„ÏÎ­Ï‡ÎµÎ¹ ÎœÎŸÎÎŸ ÏŒÏ„Î±Î½ Î· slide ÎµÎ¯Î½Î±Î¹ active) */
@keyframes xlbRankUp {
  0%   { transform: translateY(0); box-shadow: inset 0 0 0 1px rgba(95,240,255,.18); }
  25%  { transform: translateY(-8px); box-shadow: 0 0 26px rgba(95,240,255,.72); }
  60%  { transform: translateY(-3px); box-shadow: 0 0 14px rgba(95,240,255,.48); }
  100% { transform: translateY(0); box-shadow: inset 0 0 0 1px rgba(95,240,255,.18); }
}
/* rankâ€‘up: Ï€Î±Î³Ï‰Î¼Î­Î½Î¿ by default + delay Î±Ï€ÏŒ CSS var */
.xlb-item.rank-up{
  animation: xlbRankUp .9s ease-out;
  animation-play-state: paused;          /* Î´ÎµÎ½ Ï€Î±Î¯Î¶ÎµÎ¹ Î¼Î­Ï‡ÏÎ¹ Î½Î± Î³Î¯Î½ÎµÎ¹ active Ï„Î¿ slide */
  animation-delay: var(--rankDelay, 0s); /* Î¸Î± Ï„Î¿Ï… Î´ÏÏƒÎ¿Ï…Î¼Îµ 5s Î±Ï€ÏŒ JS */
  opacity: 1 !important;                 /* safety Î½Î± Î¼Î· ÎºÏÏ…Ï†Ï„ÎµÎ¯ Ï€Î¿Ï„Î­ */
  visibility: visible !important;
}

/* Î¤ÏÎ­Ï‡ÎµÎ¹ ÎœÎŸÎÎŸ ÏŒÏ„Î±Î½ Ï„Î¿ slide ÎµÎ¯Î½Î±Î¹ ÎµÎ½ÎµÏÎ³ÏŒ */
.leaderboard-slide.active .xlb-item.rank-up{
  animation-play-state: running;
}
.slide.leaderboard-slide.active .xlb-item.rank-up{ animation-play-state: running; }

/* responsive tweaks */
@media (max-width:720px){
  .xlb-item{ grid-template-columns: 72px 1fr 86px; }
  .xlb-rank{ width:56px; height:56px;}
}
@media (max-height: 760px){
  .xlb-title{ font-size: clamp(24px,4.6vw,42px); }
  .xlb-item{ padding: .6rem .85rem; margin: .4rem 0; }
}
/* ===== Pro Mode add-ons ===== */

/* grid Î¼Îµ avatar ÏƒÏ„Î®Î»Î· */
.xlb-item{
  grid-template-columns: 88px 80px 1fr max-content;/* avatar col Î±Ï€ÏŒ 56px -> 80px */
  column-gap: 24px;                           /* Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ¿ ÎºÎµÎ½ÏŒ Î±Î½Î¬Î¼ÎµÏƒÎ± ÏƒÏ„Î¹Ï‚ ÏƒÏ„Î®Î»ÎµÏ‚ */
  row-gap: .9rem; }

.xlb-name{
  font-size: clamp(28px, 4vh, 55px);
  line-height: 1.1;
  font-weight: 700;
  letter-spacing: .04em;
  color: #f5fbff;
  text-shadow: 0 1px 0 rgba(0,0,0,.25);
  display: flex; align-items: center; gap: 12px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
/* ÎœÎŸÎÎŸ Î³Î¹Î± Ï„Î¿Î½ 1Î¿ */
.xlb-item[data-rank="1"] .xlb-name {
  font-size: clamp(55px, 4.9vh, 75px); /* â†‘ Î±Ï…Î¾Î¬Î½ÎµÎ¹Ï‚ ÎµÎ´Ï Ï„Î¿ Î¼Î­Î³ÎµÎ¸Î¿Ï‚ */
  font-weight: 700;                    /* Ï€Î¹Î¿ Î­Î½Ï„Î¿Î½Î¿ Î±Î½ Î¸Î­Î»ÎµÎ¹Ï‚ */
}

/* avatar bubble */
.xlb-avatar{
  width: clamp(40px, 6.2vh, 80px);
  height: clamp(40px, 6.2vh, 80px);
  border-radius: 50%;
  position: relative; overflow: hidden;
  display: grid; place-items: center;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.16), rgba(255,255,255,.04));
  border:1px solid rgba(255,255,255,.10);
  box-shadow: 0 4px 12px rgba(0,0,0,.25), inset 0 0 0 1px rgba(255,255,255,.05);
}
.xlb-avatar::before{
  content:"";
  position:absolute; inset:-2px; border-radius:50%;
  padding:2px;
  background: conic-gradient(from 0deg, #6af6ff, #a9ffd6, #6af6ff);
  -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite: xor; mask-composite: exclude;
  opacity:.35; filter: blur(1px);
}

/* delta badge (â‡§ / â‡©) Î´Î¯Ï€Î»Î± ÏƒÏ„Î¿ ÏŒÎ½Î¿Î¼Î± */
.xlb-delta{
  font-size: .7em;
  margin-left: 9px;
  font-weight: 800;
  padding: .16rem .60rem;
  border-radius: 999px;
  line-height: 1;
  letter-spacing: .02em;
  border: 1px solid;
    border-width: 2px; /* ÎºÏÎ±Ï„Î¬ Ï„Î¿ Î¯Î´Î¹Î¿ Ï‡ÏÏÎ¼Î± Î±Ï€ÏŒ Ï„Î± .up/.down/.same */
  border-style: solid;
}
.xlb-delta.up{
  color:#0fd67a; background: rgba(15,214,122,.10); border-color: rgba(15,214,122,.35);
}
.xlb-delta.down{
  color:#ff6b7a; background: rgba(255,107,122,.12); border-color: rgba(255,107,122,.38);
}
.xlb-delta.same{
  color:#9db4c2; background: rgba(157,180,194,.10); border-color: rgba(157,180,194,.28);
}

/* custom SVG medals: Î´Î¯Î½Î¿Ï…Î¼Îµ Ï€Î¹Î¿ â€œpremiumâ€ look ÏƒÏ„Î¿Î½ ÎºÏÎºÎ»Î¿ rank */
.xlb-item.medal .xlb-rank {
  background: none !important;
  border: none !important;
  box-shadow: none !important;
}

@media (max-width: 720px) {
  .xlb-item.medal .xlb-rank {
    width: 100px;
    height: 100px;
  }
}
.xlb-rank svg{ width: 80px; height: 80px; }

/* ÎµÎ»Î±Ï†ÏÏÏ‚ Ï€Î¹Î¿ Ï†Ï‰Ï„ÎµÎ¹Î½Î¬ ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î± */
.xlb-count{
  background: rgba(255,255,255,.08);
  border-color: rgba(255,255,255,.16);
}

.xlb-item.medal.gold   .xlb-name .xlb-name-text { color: #ffd54a; text-shadow: 0 0 45px rgba(255, 213, 74, .25); }
.xlb-item.medal.silver .xlb-name .xlb-name-text { color: #d0d8e0; text-shadow: 0 0 10px rgba(208, 216, 224, .22); }
.xlb-item.medal.bronze .xlb-name .xlb-name-text { color: #d19a66; text-shadow: 0 0 10px rgba(209, 154, 102, .22); }

/* B. ÎœÎ™ÎÎ™ÎœÎ‘Î› Î³ÏÎ±Î¼Î¼Î­Ï‚ Î¼ÏŒÎ½Î¿ ÏƒÏ„Î¹Ï‚ Î³Ï‰Î½Î¯ÎµÏ‚ */
.xlb-panel { position: relative; }
.xlb-corners { pointer-events: none; position: absolute; inset: 0; }
.xlb-corners .c {
  position: absolute;
  width: 140px; height: 140px; /* â€œÏ€ÎµÎ´Î¯Î¿â€ Î³Ï‰Î½Î¯Î±Ï‚, Î¿Î¹ Î¯Î´Î¹ÎµÏ‚ Î¿Î¹ Î³ÏÎ±Î¼Î¼Î­Ï‚ ÎµÎ¯Î½Î±Î¹ ÏˆÎ¹Î»Î­Ï‚ */
  opacity: .9; filter: drop-shadow(0 0 6px rgba(0, 255, 214, .18));
}

/* ÎºÎ¬Î¸Îµ Î³Ï‰Î½Î¯Î± Î­Ï‡ÎµÎ¹ 2 Î»ÎµÏ€Ï„Î­Ï‚ Î³ÏÎ±Î¼Î¼Î­Ï‚ (Î¿ÏÎ¹Î¶ÏŒÎ½Ï„Î¹Î± & ÎºÎ¬Î¸ÎµÏ„Î·) Î¼Îµ ÎµÎ»Î±Ï†ÏÏ pulse */
@keyframes cornerPulse { 
  0%,100% { opacity: .55; } 
  50% { opacity: .9; } 
}

.xlb-corners .c::before,
.xlb-corners .c::after {
  content: "";
  position: absolute;
  background: linear-gradient(90deg, rgba(0,255,214,.0), rgba(0,255,214,.8), rgba(0,255,214,.0));
  animation: cornerPulse 3.2s ease-in-out infinite;
}

/* top-left */
.xlb-corners .tl { top: 10px; left: 10px; }
.xlb-corners .tl::before { /* Î¿ÏÎ¹Î¶ÏŒÎ½Ï„Î¹Î± Î³ÏÎ±Î¼Î¼Î® */
  top: 0; left: 0; width: 120px; height: 3px;
}
.xlb-corners .tl::after {  /* ÎºÎ¬Î¸ÎµÏ„Î· Î³ÏÎ±Î¼Î¼Î® */
  top: 0; left: 0; width: 3px; height: 120px;
  background: linear-gradient(180deg, rgba(0,255,214,.0), rgba(0,255,214,.8), rgba(0,255,214,.0));
}

/* top-right */
.xlb-corners .tr { top: 10px; right: 10px; transform: scaleX(-1); }

/* bottom-left */
.xlb-corners .bl { bottom: 10px; left: 10px; transform: scaleY(-1); }

/* bottom-right */
.xlb-corners .br { bottom: 10px; right: 10px; transform: scale(-1); }

/* ÎºÏÎ¬Ï„Î± Ï„Î¿ Î»ÎµÏ€Ï„ÏŒ neon frame, Î±Î»Î»Î¬ ÎºÎ¬Ï„Ï‰ Î±Ï€ÏŒ Ï„Î¿ content */
.xlb-panel{ position: relative; z-index: 0; }
.xlb-panel::before{ z-index: 0; }
.xlb-item::after{
  height: clamp(2px, 0.7vh, 6px);
} /* Î»Î¯Î³Î¿ Ï€Î¹Î¿ â€œÎ³ÎµÎ¼Î¬Ï„Î·â€ Î¼Ï€Î¬ÏÎ± */
/* Î· Î»Î¯ÏƒÏ„Î± Î½Î± ÎºÎ¬Î¸ÎµÏ„Î±Î¹ Ï€Î¬Î½Ï‰ Î±Ï€ÏŒ Î¿Ï„Î¹Î´Î®Ï€Î¿Ï„Îµ Î´Î¹Î±ÎºÎ¿ÏƒÎ¼Î·Ï„Î¹ÎºÏŒ ÎºÎ±Î¹ Î½Î± Î¼Î·Î½ ÎºÎ¿Î»Î»Î¬ÎµÎ¹ ÏƒÏ„Î¿ header */
.xlb-list{
  flex: 1 1 auto;
  min-height: 0;
  display: grid;
  /* 1Î¿Ï‚ Ï€Î¹Î¿ â€œÏˆÎ·Î»ÏŒÏ‚â€, Î¿Î¹ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î¿Î¹ Î¯ÏƒÎ¿Î¹ */
  grid-template-rows: 1.22fr repeat(7, 1fr);
  row-gap: clamp(6px, 1.2vh, 16px);       /* Î»Î¯Î³Î¿ Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ¿ ÎºÎµÎ½ÏŒ */
  column-gap: 0;
  padding: clamp(6px, 1.2vh, 16px) clamp(10px, 2vw, 24px) clamp(8px, 1.6vh, 18px);
  overflow: hidden;
}
/* extra â€œÎ±Î½Î¬ÏƒÎ±â€ Î¼ÏŒÎ½Î¿ ÎºÎ¬Ï„Ï‰ Î±Ï€ÏŒ Ï„Î¿Î½ 1Î¿ */
.xlb-item[data-rank="1"]{ margin-bottom: clamp(6px, 1vh, 14px); }
/* Ï„Î¿ Ï€ÏÏÏ„Î¿ row Î½Î± Î¼Î· â€œÎºÎ¿Î»Î»Î¬ÎµÎ¹â€ Ï€Î¬Î½Ï‰ */
.xlb-item:first-child{
  margin-top: 0.6rem;
}
/* Neon glow Î³Î¹Î± Ï„Î¿Ï…Ï‚ 3 Ï€ÏÏÏ„Î¿Ï…Ï‚ */
/* ğŸ† Î Î»Î®ÏÎ·Ï‚ Î´Î¹Î±Ï†Î¿ÏÎ¿Ï€Î¿Î¯Î·ÏƒÎ· 1Î·Ï‚ Î¸Î­ÏƒÎ·Ï‚ */
.xlb-item[data-rank="1"]{
  background:
    linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03)),
    radial-gradient(800px 240px at 0% 50%, rgba(255,209,102,.16), transparent 60%);
  border-color: rgba(255, 209, 102, .55);
  box-shadow:
    inset 0 0 0 2px rgba(255, 209, 102, .32),
    0 0 22px rgba(255, 209, 102, .18);
  position: relative;
}

/* Î»Î¯Î³Î¿ Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ± Î±Î»Î»Î¬ Ï‡Ï‰ÏÎ¯Ï‚ Î½Î± â€œÏ€Î­Ï†Ï„Î¿Ï…Î½â€ â€“ ÎºÎ­Î½Ï„ÏÎ¿ Ï€Î¬Î½Ï„Î± */
.xlb-item[data-rank="1"] .xlb-rank{
  transform: scale(1.05);
  transform-origin: center center;
}
.xlb-item[data-rank="1"] .xlb-avatar{
  transform: scale(1.04);
  transform-origin: center center;
}
/* Ï€Î¹Î¿ Î­Î½Ï„Î¿Î½Î· progress-bar Î¼ÏŒÎ½Î¿ Î³Î¹Î± Ï„Î¿Î½ 1Î¿ */


/* Î»ÎµÏ€Ï„Î® neon Î¼Ï€Î¬ÏÎ± ÏƒÏ„Î·Î½ Î±ÏÎ¹ÏƒÏ„ÎµÏÎ® Î¬ÎºÏÎ· */
.xlb-item[data-rank="1"]::before{
  content:"";
  position:absolute; left:0; top:8px; bottom:8px; width:4px;
  border-radius:4px;
  background: linear-gradient(180deg, #ffe17e, #ffcc4d);
  box-shadow: 0 0 18px #ffcc4d, 0 0 4px rgba(0,0,0,.25) inset;
  opacity:.95;
}

/* Î»Î¯Î³Î¿ â€œÎ¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ¿Î¹â€ Î¿Î¹ badge/avatars Î³Î¹Î± Ï„Î¿Î½ 1Î¿ */
.xlb-item[data-rank="1"] .xlb-rank{ transform: scale(1.08); }
.xlb-item[data-rank="1"] .xlb-avatar{ transform: scale(1.05); }

/* Ï€Î¹Î¿ premium counter chip */
.xlb-item[data-rank="1"] .xlb-count{
  background: linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.06));
  border-color: rgba(255, 209, 102, .55);
  color: #fff7dc;
  text-shadow: 0 1px 0 rgba(0,0,0,.35);
}

/* neon glow ÏƒÏ„Î¿ ÏŒÎ½Î¿Î¼Î± Ï„Î¿Ï… 1Î¿Ï… */
.xlb-item[data-rank="1"] .xlb-name .xlb-name-text{
  color: #ffe385;
  text-shadow:
    0 0 10px rgba(255, 227, 133, .45),
    0 0 18px rgba(255, 199, 72, .30);
}

/* Î¼Î¹ÎºÏÎ® ÎºÎ¿ÏÏÎ½Î· ribbon ÏƒÏ„Î·Î½ Ï€Î¬Î½Ï‰-Î´ÎµÎ¾Î¹Î¬ Î³Ï‰Î½Î¯Î± Ï„Î·Ï‚ ÏƒÎµÎ¹ÏÎ¬Ï‚ */
.xlb-item[data-rank="1"] .xlb-champ{
  position:absolute; right:10px; top:-6px;
  width:48px; height:48px; opacity:.9;
  filter: drop-shadow(0 6px 10px rgba(255, 209, 102, .25));
}

/* Î´Î¹Î±ÎºÏÎ¹Ï„Î¹ÎºÏŒ highlight ÏŒÏ„Î±Î½ Î³Î¯Î½ÎµÏ„Î±Î¹ rank-up ÎºÎ±Î¹ ÎµÎ¯Î½Î±Î¹ 1Î¿Ï‚ */
.xlb-item[data-rank="1"].rank-up{
  animation: champPulse .9s ease-out;
}
@keyframes champPulse{
  0%{ box-shadow: 0 0 0 rgba(255, 209, 102, 0.0); }
  40%{ box-shadow: 0 0 42px rgba(255, 209, 102, .45); }
  100%{ box-shadow: 0 10px 36px rgba(255, 209, 102, .20); }
}

/* Wrapper Î³Î¹Î± Ï„Î¿ Î½Î¿ÏÎ¼ÎµÏÎ¿ ÎºÎ±Î¹ Ï„Î·Î½ ÎºÎ¿ÏÏŒÎ½Î± Ï„Î¿Ï… Ï€ÏÏÏ„Î¿Ï… */
.crown-wrapper{
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;     /* ÎºÎ¬Î¸ÎµÏ„Î¿ ÎºÎ­Î½Ï„ÏÎ¿ */
  gap: clamp(3px, .5vh, 8px);
}

/* Î£Ï„Ï…Î» Î³Î¹Î± Ï„Î·Î½ ÎºÎ¿ÏÏŒÎ½Î± */
.crown-wrapper .xlb-crown {
  display: block;
  line-height: 0;
}

.crown-wrapper .xlb-crown svg{
  width: clamp(36px, 4.6vh, 56px);
  height: clamp(36px, 4.6vh, 56px);
  transform: none;             /* ÏŒÏ‡Î¹ translateY */
}

@supports not ((backdrop-filter: blur(2px)) or (-webkit-backdrop-filter: blur(2px))) {
  #popup-overlay { backdrop-filter: none; -webkit-backdrop-filter: none; }
}

/* 2) Î£Î²Î®Î½Î¿Ï…Î¼Îµ Ï„Î¿ Î­Î¾Ï„ÏÎ± conic-glow Î±Ï€ÏŒ Ï„Î¿ ::before */


/* 3) Î¤Î¿ ÎµÎ¹ÎºÏŒÎ½Î¹ÏƒÎ¼Î± Î¼ÎµÏ„Î±Î»Î»Î¯Î¿Ï… Î½Î± Î³ÎµÎ¼Î¯Î¶ÎµÎ¹ ÏƒÏ‰ÏƒÏ„Î¬ Ï„Î¿ badge box */
.xlb-rank .xlb-medal{
  display: block;
  width: 78%;
  height: 78%;
  object-fit: contain;                 /* ÏƒÏ‰ÏƒÏ„Î­Ï‚ Î±Î½Î±Î»Î¿Î³Î¯ÎµÏ‚ */
  filter: drop-shadow(0 4px 10px rgba(0,0,0,.35)); /* Î´Î¹Î±ÎºÏÎ¹Ï„Î¹ÎºÎ® ÏƒÎºÎ¹Î¬ */
}

/* 4) Î‘Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ ÎºÎ±Î½ÏŒÎ½Î±Ï‚ Î³Î¹Î± SVG Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ .xlb-rank, ÎºÏÏÏˆâ€™ Ï„Î¿ ÏƒÏ„Î¿Ï…Ï‚ medal rows */

.xlb-item[data-rank="1"] {
  position: relative;
  overflow: hidden;
}

.xlb-item[data-rank="1"]::after {
  content: "";
  position: absolute;
  top: 0;
  left: -150%;
  width: 250%;
  height: 100%;
  background: linear-gradient(
    120deg,
    transparent 0%,
    rgba(255,255,255,0.25) 50%,
    transparent 100%
  );
  animation: shineRow 6s ease-in-out infinite;
  pointer-events: none;
}

@keyframes shineRow {
  0%   { transform: translateX(-100%); opacity: 0; }
  10%  { opacity: 1; }
  40%  { transform: translateX(60%); opacity: 1; }
  50%  { opacity: 0; }
  100% { transform: translateX(60%); opacity: 0; }
}
/* ğŸ¥ˆ SILVER â€“ 2Î· Î¸Î­ÏƒÎ· */
.xlb-item[data-rank="2"]::after,
.xlb-item.medal.silver::after,
.xlb-item.silver::after,
.xlb-item.rank-2::after {
  background: linear-gradient(90deg,
    rgba(192,192,192,.25),
    rgba(235,235,235,.95),
    rgba(192,192,192,.65)
  ) !important;
  box-shadow: 0 0 10px rgba(192,192,192,.55) !important;
}

/* ğŸ¥‰ BRONZE â€“ 3Î· Î¸Î­ÏƒÎ· */
.xlb-item[data-rank="3"]::after,
.xlb-item.medal.bronze::after,
.xlb-item.bronze::after,
.xlb-item.rank-3::after {
  background: linear-gradient(90deg,
    rgba(184,115,51,.25),
    rgba(205,133,63,.95),
    rgba(184,115,51,.65)
  ) !important;
  box-shadow: 0 0 10px rgba(184,115,51,.55) !important;
}
/* Î£ÎµÎ¹ÏÎ¬ Ï„Î¯Ï„Î»Î¿Ï… Î¼Îµ Î´ÏÎ¿ logos */
.xlb-title-row{
  display: flex;
  align-items: center;
  justify-content: center;
  gap: clamp(12px, 2.8vw, 36px);

}

/* â€œGlassâ€ logo bubbles links/ÎµÎ¹ÎºÏŒÎ½ÎµÏ‚ */
.xlb-logo{
  width: clamp(46px, 7.5vw, 88px);
  height: clamp(46px, 7.5vw, 88px);
  border-radius: 50%;
  position: relative;
  overflow: hidden;
  flex: 0 0 auto;

  /* glass */
  background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.14);
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  box-shadow:
    0 8px 26px rgba(0,0,0,.35),
    inset 0 0 0 1px rgba(255,255,255,.06),
    0 0 18px rgba(95,240,255,.22); /* Î´Î¹Î±ÎºÏÎ¹Ï„Î¹ÎºÏŒ Î½ÎµÎ¿Î½ Î³ÏÏÏ‰ Î³ÏÏÏ‰ */
}

/* Î»ÎµÏ€Ï„ÏŒÏ‚ conic â€œÎ½ÎµÎ¿Î½â€ Î´Î±ÎºÏ„ÏÎ»Î¹Î¿Ï‚ */
.xlb-logo::before{
  content:"";
  position:absolute; inset:-2px; border-radius:50%;
  padding:2px;
  background: conic-gradient(from 0deg, #6af6ff, #a9ffd6, #6af6ff);
  -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
          mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite: xor; mask-composite: exclude;
  opacity:.35; filter: blur(1px);
}

/* Î· ÎµÎ¹ÎºÏŒÎ½Î± Î¼Î­ÏƒÎ± â€“ Î½Î± Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ ÎºÎ±Î¸Î±ÏÎ¬ Î¼Îµ Î´Î¹Î±Ï†Î±Î½Î­Ï‚ Ï†ÏŒÎ½Ï„Î¿ */
.xlb-logo img{
  width: 100%;
  height: 100%;
  object-fit: contain;
  display: block;
  filter: drop-shadow(0 0 10px rgba(0,0,0,.35));
  
}

/* Î¤Î¯Ï„Î»Î¿Ï‚ Î½Î± ÎºÎ¬Î¸ÎµÏ„Î±Î¹ ÏŒÎ¼Î¿ÏÏ†Î± Î±Î½Î¬Î¼ÎµÏƒÎ± ÏƒÏ„Î± logos */
.xlb-title-row .xlb-title{
  margin: 0; /* Î±Î½ Ï…Ï€Î®ÏÏ‡Îµ top margin Î±Ï€ÏŒ Ï€ÏÎ¹Î½ */
  line-height: 1.05;
  white-space: nowrap;
}

/* ÎœÎ¹ÎºÏÎ­Ï‚ Î¿Î¸ÏŒÎ½ÎµÏ‚ â€“ ÎºÏÏÏˆÎµ Ï„Î± logos Î³Î¹Î± Î½Î± Î¼Î· â€œÏƒÏ€Î¬ÎµÎ¹â€ */
@media (max-width: 720px){
  .xlb-logo{ display:none; }
}
/* === Centering & medal size tweaks (override) === */

/* 1) Î‘Ï€ÏŒÎ»Ï…Ï„Î¿ ÎºÎµÎ½Ï„ÏÎ¬ÏÎ¹ÏƒÎ¼Î± avatar & rank ÏƒÏ„Î¿ ÎºÎµÎ»Î¯ Ï„Î¿Ï…Ï‚ */
.xlb-avatar,
.xlb-rank{
align-self: center;          /* ÎºÎ¬Î¸ÎµÏ„Î± ÏƒÏ„Î¿ grid row */
  justify-self: center;        /* Î¿ÏÎ¹Î¶ÏŒÎ½Ï„Î¹Î± ÏƒÏ„Î¿ grid column */
  display: flex;
  align-items: center;
  justify-content: center;
}

/* 2) Avatar: Î½Î± â€œÎºÎ¬Î¸ÎµÏ„Î±Î¹â€ Î±ÎºÏÎ¹Î²ÏÏ‚ ÏƒÏ„Î¿ ÎºÎ­Î½Ï„ÏÎ¿ Ï‡Ï‰ÏÎ¯Ï‚ Î¿Ï€Ï„Î¹ÎºÎ® ÎºÎ±Î¸Î¯Î¶Î·ÏƒÎ· */
.xlb-avatar{
  width: clamp(40px, 6.2vh, 80px) !important;
  height: clamp(40px, 6.2vh, 80px) !important;
}
.xlb-avatar img{
  display: block;
  width: 100%;
  height: 100%;
  object-fit: cover;
  object-position: 50% 50%;
}

/* 3) Rank badge: ÎºÎ±Î¸Î±ÏÏŒ ÎºÎµÎ½Ï„ÏÎ¬ÏÎ¹ÏƒÎ¼Î± Î±ÏÎ¹Î¸Î¼Î¿Ï/ÎµÎ¹ÎºÏŒÎ½Î±Ï‚ */
.xlb-rank{
  line-height: 1;                              /* Î½Î± Î¼Î·Î½ Â«Ï„ÏÎ±Î²Î¬ÎµÎ¹Â» Ï€ÏÎ¿Ï‚ Ï„Î± ÎºÎ¬Ï„Ï‰ */
  width: clamp(44px, 7vh, 96px);
  height: clamp(44px, 7vh, 96px);
}

/* 4) ÎœÎ¹ÎºÏÏŒÏ„ÎµÏÎ± Î¼ÎµÏ„Î¬Î»Î»Î¹Î± Î¼Î­ÏƒÎ± ÏƒÏ„Î¿ rank badge (Ï‡Ï‰ÏÎ¯Ï‚ Î½Î± Â«ÎºÎ¿Î»Î»Î¬Î½ÎµÂ» ÏƒÏ„Î± Ï„Î¿Î¹Ï‡ÏÎ¼Î±Ï„Î±) */
.xlb-rank .xlb-medal{
  width: 82% !important;
  height: 82% !important;
  object-fit: contain !important;
}

/* 6) (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ) Î»Î¯Î³Î¿ Ï€Î±ÏÎ±Ï€Î¬Î½Ï‰ â€œÎ±Î½Î¬ÏƒÎ±â€ ÏƒÏ„Î¿ ÎºÎµÎ»Î¯ ÏÏƒÏ„Îµ Î½Î± Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ ÎµÎ½Ï„ÎµÎ»ÏÏ‚ centered */
.xlb-item{
  padding-top: clamp(6px, 0.8vh, 14px) !important;
  padding-bottom: clamp(6px, 0.8vh, 14px) !important;
}
/* --- Fix: 1Î¿Ï‚ ÎºÏÏÎ²ÎµÎ¹ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ (z-index/stacking order) --- */

/* Î¤Î¿ row Î½Î± ÎµÎ¯Î½Î±Î¹ stacking context */
.xlb-item{
  position: relative;
  z-index: 0;
}

/* ÎŒÎ›Î‘ Ï„Î± overlays (progress ::after, neon ::before, shine ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î¿) ÎºÎ¬Ï„Ï‰ Î±Ï€ÏŒ Ï„Î¿ content */
.xlb-item::before,
.xlb-item::after,
.xlb-item .xlb-shine{
  z-index: 0;
  pointer-events: none; /* Î½Î± Î¼Î·Î½ â€œÏ€Î¹Î¬Î½ÎµÎ¹â€ clicks */
}

/* Î¤Î¿ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÏŒ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ Î Î‘ÎÎ© Î±Ï€â€™ ÏŒÎ»Î± */
.xlb-item .xlb-rank,
.xlb-item .xlb-avatar,
.xlb-item .xlb-name,
.xlb-item .xlb-count{
  position: relative;
  z-index: 1;
}

/* Î ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬, Ï€Î¹Î¿ Î®Ï€Î¹Î± Î¼ÎµÎ³Î­Î¸Î· Î³Î¹Î± Î½Î± Î¼Î· â€œÏ€Î¹Î­Î¶Î¿Î½Ï„Î±Î¹â€ */
.xlb-item[data-rank="1"] .xlb-rank{ transform: scale(1.03); }
.xlb-item[data-rank="1"] .xlb-avatar{ transform: scale(1.03); }
/* --- First row: premium look Ï‡Ï‰ÏÎ¯Ï‚ Î½Î± ÏƒÎºÎµÏ€Î¬Î¶ÎµÎ¹ Ï„Î¿Î½ 2Î¿ --- */
/* Î£Î²Î®ÏƒÎ¹Î¼Î¿ ÎºÏ…ÎºÎ»Î±ÎºÎ¯Î¿Ï… ÏƒÏ„Î¿Ï…Ï‚ Ï€ÏÏÏ„Î¿Ï…Ï‚ Ï„ÏÎµÎ¹Ï‚ */
.xlb-item.medal .xlb-rank,
.xlb-item.medal .xlb-rank::before {
  background: none !important;
  border: none !important;
  box-shadow: none !important;
  content: none !important;
}
/* ÎœÎ¹ÎºÏÏŒÏ„ÎµÏÎ¿ ÎºÏ…ÎºÎ»Î¬ÎºÎ¹ ÏƒÏ„Î¿Ï…Ï‚ Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î¿Ï…Ï‚ */
.xlb-item:not(.medal) .xlb-rank {
  width: clamp(55px, 4.6vh, 70px) !important;
  height: clamp(55px, 4.6vh, 70px) !important;
  line-height: 1 !important;
}
/* Î Î»Î±Î¯ÏƒÎ¹Î¿ ÎºÎ¿ÏÏÎ½Î±Ï‚ + Î±ÏÎ¹Î¸Î¼Î¿Ï ÎœÎŸÎÎŸ Î³Î¹Î± Ï„Î¿Î½ 1Î¿: Î¼Î¹ÎºÏÏŒÏ„ÎµÏÎ¿ ÎºÎ±Î¹ centered */
.xlb-item[data-rank="1"] .crown-wrapper{
  align-self: center;          /* ÎºÎ¬Î¸ÎµÏ„Î± ÏƒÏ„Î¿ ÎºÎ­Î½Ï„ÏÎ¿ Ï„Î¿Ï… row */
  justify-self: end;           /* Î´ÎµÎ¾Î¹Î¬ ÏƒÏ„Î¿ grid */
  display: flex;
  flex-direction: column;      /* ÎºÎ¿ÏÏÎ½Î± Ï€Î¬Î½Ï‰, Î±ÏÎ¹Î¸Î¼ÏŒÏ‚ ÎºÎ¬Ï„Ï‰ */
  align-items: center;
  gap: clamp(4px, .8vh, 10px);

  /* Î‘ÎšÎ¡Î™Î’Î©Î£ ÏŒÏ€Ï‰Ï‚ .xlb-count */
  padding: clamp(2px, 0.1vh, 2px) clamp(10px, 1.4vw, 18px);
  min-width: clamp(56px, 8vh, 120px);
  border-radius: 18px;
  background: rgba(255,255,255,.08);

  /* Î§ÏÏ…ÏƒÏŒ Ï€ÎµÏÎ¯Î³ÏÎ±Î¼Î¼Î± (ÏŒÏ‡Î¹ glow) */
  border: 1px solid rgba(255, 209, 102, .65);
}

/* ÎœÎ­Î³ÎµÎ¸Î¿Ï‚ ÎºÎ¿ÏÏÎ½Î±Ï‚ Î»Î¯Î³Î¿ Î¼Î¹ÎºÏÏŒÏ„ÎµÏÎ¿ */
.xlb-item[data-rank="1"] .crown-wrapper .xlb-crown svg{
  width: clamp(32px, 3.6vh, 46px);
  height: clamp(32px, 3.6vh, 46px);
}

/* ÎœÎ­Î³ÎµÎ¸Î¿Ï‚ Î±ÏÎ¹Î¸Î¼Î¿Ï Ï€ÏÎ¿Ï€Î¿Î½Î®ÏƒÎµÏ‰Î½ Ï€Î¹Î¿ â€œÏƒÏ†Î¹Ï‡Ï„ÏŒâ€ */
.xlb-item[data-rank="1"] .crown-wrapper .xlb-count-number {
  font-weight: 800;
  font-size: clamp(30px, 2.6vh, 40px);
  line-height: 1;
}

  </style>
</head>
<body>
  <div id="digitalClock"></div>

  <div class="slideshow-container">
<div class="slide portrait" style="background-image: url('https://i.postimg.cc/NFXhZL3y/IMG-4924-2.jpg')"></div>
    <div class="slide portrait" style="background-image: url('https://i.postimg.cc/mZ1GP6Pb/IMG-4925.jpg')"></div>
    <div class="slide portrait" style="background-image: url('https://i.postimg.cc/wjMFMJbN/IMG-4936.jpg')"></div>
        <div class="slide portrait" style="background-image: url('https://i.postimg.cc/9XrB1x04/IMG-4937.jpg')"></div>
    <div class="slide" style="background-image: url('https://i.postimg.cc/025nj58G/processed-2-DA30989-5818-4-DF0-A5-A1-A9-A04-F93091-B.jpg')"></div>
        <div class="slide" style="background-image: url('https://i.postimg.cc/631b9KMG/Your-paragraph-text-2.jpg')"></div>
    <div class="slide" style="background-image: url('https://i.postimg.cc/02S01bpP/IMG-4933.jpg')"></div>
      <div class="slide" style="background-image: url('https://i.postimg.cc/SKZpMBLK/IMG-4926.jpg')"></div>

<div class="slide leaderboard-slide">
  <div class="xlb-safe">
    <div class="xlb-panel">
      <!-- ÎŸÎ›ÎŸ Ï„Î¿ Ï€ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ Ï„Î¿Ï… Ï€Î¯Î½Î±ÎºÎ± ÏƒÎ¿Ï… -->
    </div>
  </div>
</div>

    <!-- â¬‡ï¸ Î¤Î¿ Leaderboard Î¸Î± Ï€ÏÎ¿ÏƒÏ„ÎµÎ¸ÎµÎ¯ ÎµÎ´Ï Î±Ï€ÏŒ Ï„Î·Î½ populateLeaderboard() -->
  </div>

  <script>
    const PREV_RANKS_KEY = "previousRanks";
window.previousRanks = window.previousRanks || JSON.parse(localStorage.getItem(PREV_RANKS_KEY) || "{}");
    // Slideshow
let slides = [];
let currentSlide = 0;
let slideTimer;

function showSlide(index) {
  clearTimeout(slideTimer);

  slides.forEach((slide) => slide.classList.remove('active'));

  const slideEl = slides[index];
  slideEl.classList.add('active');

  const isLeaderboard = slideEl.classList.contains("leaderboard-slide");
  document.querySelectorAll('.leaderboard-slide').forEach(s => {
  s.style.removeProperty('--rankDelay');
});

// Î‘Î½ Î±Ï…Ï„ÏŒ Ï„Î¿ slide ÎµÎ¯Î½Î±Î¹ leaderboard, Î´ÏÏƒÎµ delay 5s
if (isLeaderboard) {
  slideEl.style.setProperty('--rankDelay', '5s');
}
  const clock = document.getElementById("digitalClock");
  if (clock) {
    if (isLeaderboard) {
      clock.classList.remove("visible");
      clock.classList.add("hidden");
    } else {
      clock.classList.remove("hidden");
      clock.classList.add("visible");
    }
  }

  // ÎœÎŸÎÎŸ Î±Ï…Ï„ÏŒ Î±Î»Î»Î¬Î¾Î±Î¼Îµ: +5s ÏƒÏ„Î¿ leaderboard
  const BASE = 35000;      // ÏŒÏƒÎ¿ Î¼Î­Î½Î¿Ï…Î½ Ï„Î± Ï…Ï€ÏŒÎ»Î¿Î¹Ï€Î±
  const EXTRA = 5000;     // +5s Î¼ÏŒÎ½Î¿ Î³Î¹Î± leaderboard
  const duration = isLeaderboard ? (BASE + EXTRA) : BASE;

  if (isLeaderboard && typeof retriggerRankAnims === 'function') {
    setTimeout(() => retriggerRankAnims(slideEl), 80);
  }

  slideTimer = setTimeout(() => {
    currentSlide = (currentSlide + 1) % slides.length;
    showSlide(currentSlide);
  }, duration);

}
function retriggerRankAnims(root = document) {
  root.querySelectorAll('.xlb-item.rank-up').forEach(el => {
    el.style.animation = 'none';
    void el.offsetHeight;
    el.style.animation = '';
  });
}

window.addEventListener("DOMContentLoaded", () => {
  populateLeaderboard();      // ÏÏƒÏ„Îµ Î½Î± Î¼Î· Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ Î¬Î´ÎµÎ¹Î¿ ÏƒÏ„Î¿ load (Ï€ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÏŒ)
  startRealtimeLeaderboard(); // ÎµÎ½Î·Î¼ÎµÏÏÎ½ÎµÎ¹ Î¼Îµ ÎºÎ¬Î¸Îµ scan

  startScanSignalListener();  // Î³Î¹Î± Ï„Î± popups
  resetMonthlyDataIfNeeded?.();

  slides = document.querySelectorAll('.slide');
  showSlide(0);
});

    // Name formatting rules
    function formatName(name) {
      if (!name || typeof name !== "string") return name;
      name = name.trim().toUpperCase();

      const exceptions = ["Î£Î¤Î•Î›Î™ÎŸÎ£", "Î£Î¤Î•Î¡Î“Î™ÎŸÎ£", "ÎœÎ™Î›Î¤ÎŸÎ£", "Î§Î¡Î—Î£Î¤ÎŸÎ£", "Î£Î¤Î¡Î‘Î¤ÎŸÎ£", "Î Î‘Î¥Î›ÎŸÎ£", "Î“Î™Î©Î¡Î“ÎŸÎ£","ÎÎ™ÎšÎŸÎ£","ÎœÎ‘ÎÎŸÎ£","Î‘Î›Î•ÎšÎŸÎ£","Î˜Î‘ÎÎŸÎ£"];

      if (name.endsWith("ÎŸÎ£")) {
        if (exceptions.includes(name)) {
          return name.slice(0, -1); // Î£Î¤Î•Î›Î™ÎŸÎ£ â†’ Î£Î¤Î•Î›Î™ÎŸ
        } else {
          return name.slice(0, -2) + "Î•"; // ÎÎ™ÎšÎŸÎ£ â†’ ÎÎ™ÎšÎ•
        }
      }

      if (name.endsWith("Î—Î£")) {
        return name.slice(0, -1); // Î Î‘ÎÎ‘Î“Î—Î£ â†’ Î Î‘ÎÎ‘Î“Î—
      }

      if (name.endsWith("Î‘Î£")) {
        return name.slice(0, -1); // Î˜Î‘ÎÎ‘Î£Î—Î£ â†’ Î˜Î‘ÎÎ‘Î£Î—
      }

      return name;
    }

    // Show popup
function showPopup(name, isActive) {
  // ÎšÎ±Î»Î·Î¼Î­ÏÎ±/ÎšÎ±Î»Î·ÏƒÏ€Î­ÏÎ±
  const hour = new Date().getHours();
  const greeting = hour < 12 ? "ÎšÎ±Î»Î·Î¼Î­ÏÎ±" : "ÎšÎ±Î»Î·ÏƒÏ€Î­ÏÎ±";

  // ÎœÏŒÎ½Î¿ Î¼Î¹ÎºÏÏŒ ÏŒÎ½Î¿Î¼Î± (ÏƒÎµ Ï€ÎµÏÎ¯Ï€Ï„Ï‰ÏƒÎ· Ï€Î¿Ï… Î®ÏÎ¸Îµ full name)
  const firstOnly = String(name || "").trim().split(/\s+/)[0] || "";
  const fixedName = formatName(firstOnly);

  // Overlay
const overlay = document.createElement("div");
overlay.id = "popup-overlay";
overlay.classList.add(isActive ? "active" : "inactive"); // <-- Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—
  overlay.addEventListener("mousemove", (e) => {
    const r = overlay.getBoundingClientRect();
    const card = overlay.querySelector(".close-wipe");
    if (card) {
      card.style.setProperty("--x", `${e.clientX - r.left}px`);
      card.style.setProperty("--y", `${e.clientY - r.top}px`);
    }
  });

  // ÎšÎ¬ÏÏ„Î±
// ÎšÎ¬ÏÏ„Î±
const card = document.createElement("div");
card.className = `popup-card ${isActive ? "active" : "inactive"}`; // <-- Î Î¡ÎŸÎ£Î˜Î—ÎšÎ—

  // Î ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿
 card.innerHTML = `
  <div class="close-wipe"></div>

  <div class="popup-title ${isActive ? "active" : "inactive"}">
    ${greeting} ${fixedName}
  </div>

  <div class="popup-line ${isActive ? "active" : "inactive"}" style="transition-delay:.08s">
    Î— ÏƒÏ…Î½Î´ÏÎ¿Î¼Î® ÏƒÎ¿Ï… ÎµÎ¯Î½Î±Î¹ <b>${isActive ? "ÎµÎ½ÎµÏÎ³Î®" : "Î±Î½ÎµÎ½ÎµÏÎ³Î®"}</b>.
  </div>

  <div class="popup-line ${isActive ? "active" : "inactive"}" style="transition-delay:.16s">
    ${isActive ? "ÎšÎ±Î»Î® Ï€ÏÎ¿Ï€ÏŒÎ½Î·ÏƒÎ·!" : "Î— Î¿Î¼Î¬Î´Î± Î¼Î±Ï‚ ÏƒÎµ Ï€ÎµÏÎ¹Î¼Î­Î½ÎµÎ¹!"}
  </div>

  <div class="popup-line ${isActive ? "active" : "inactive"}" style="transition-delay:.24s">
    <span class="badge ${isActive ? "active" : "inactive"}">
      ${isActive ? "ğŸŸ¢ Active Member" : "ğŸ”´ Inactive Member"}
    </span>
  </div>
`;

  overlay.appendChild(card);
  document.body.appendChild(overlay);

  // staggered ÎµÎ¼Ï†Î¬Î½Î¹ÏƒÎ· Î³ÏÎ±Î¼Î¼ÏÎ½
  requestAnimationFrame(() => {
    overlay.querySelectorAll(".popup-line").forEach((el) => {
      // Î´ÏÏƒÎµ Ï‡ÏÏŒÎ½Î¿ ÏƒÏ„Î·Î½ ÎµÎ¯ÏƒÎ¿Î´Î¿ Ï„Î·Ï‚ ÎºÎ¬ÏÏ„Î±Ï‚
      setTimeout(() => el.classList.add("show"), parseFloat(el.style.transitionDelay || "0") * 1000 + 60);
    });
  });

  // Î‘Ï…Ï„ÏŒÎ¼Î±Ï„Î¿ ÎºÎ»ÎµÎ¯ÏƒÎ¹Î¼Î¿
  setTimeout(() => {
    overlay.style.opacity = "0";
    overlay.style.transition = "opacity .4s ease";
    setTimeout(() => overlay.remove(), 400);
    localStorage.removeItem("lastScannedId");
  }, 4800);
}

  function getMonthlyCounts() {
  const raw = localStorage.getItem("attendanceData"); // âœ… Î Î¡ÎŸÎ£ÎŸÎ§Î— ÎµÎ´Ï
  if (!raw) return {};

  const data = JSON.parse(raw);
  const now = new Date();
  const thisMonth = now.getMonth() + 1;
  const thisYear = now.getFullYear();

  const counts = {}; // { id: { name: "...", count: n } }

  for (const dateStr in data) {
    const [day, month, year] = dateStr.split("/").map(Number);
    if (month === thisMonth && year === thisYear) {
      data[dateStr].forEach(entry => {
        if (entry.id && entry.name && entry.type !== "income") {
          if (!counts[entry.id]) {
            counts[entry.id] = { name: entry.name, count: 0 };
          }
          counts[entry.id].count += 1;
        }
      });
    }
  }

  return counts;
}
function resetMonthlyDataIfNeeded() {
  const now = new Date();
  const currentMonth = now.getMonth();
  const currentYear = now.getFullYear();

  const lastReset = localStorage.getItem("lastLeaderboardReset");
  const [lastYear, lastMonth] = lastReset ? lastReset.split("-").map(Number) : [];

  if (lastYear !== currentYear || lastMonth !== currentMonth) {
    const data = JSON.parse(localStorage.getItem("mockData") || "{}");

    // ÎšÏÎ±Ï„Î¬Î¼Îµ Î¼ÏŒÎ½Î¿ entries Ï„Î¿Ï… Ï„ÏÎ­Ï‡Î¿Î½Ï„Î¿Ï‚ Î¼Î®Î½Î±
    const newData = {};
    for (const date in data) {
      const [day, month, year] = date.split("/").map(Number);
      if (month - 1 === currentMonth && year === currentYear) {
        newData[date] = data[date];
      }
    }

    localStorage.setItem("mockData", JSON.stringify(newData));
    localStorage.setItem("lastLeaderboardReset", `${currentYear}-${currentMonth}`);
    console.log("ğŸ§¹ ÎœÎ·Î´ÎµÎ½Î¯ÏƒÏ„Î·ÎºÎ±Î½ Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î± leaderboard Î³Î¹Î± Î½Î­Î¿ Î¼Î®Î½Î±.");
  }
}
// Î’Î¬Î»Îµ Î±Ï…Ï„ÏŒ ÎšÎ‘Î ÎŸÎ¥ ÎœÎ™Î‘ Î¦ÎŸÎ¡Î‘ Ï€Î¬Î½Ï‰ Î±Ï€ÏŒ Ï„Î·Î½ populateLeaderboard
let previousRanks = {};
try {
  previousRanks = JSON.parse(localStorage.getItem("previousRanks") || "{}");
} catch(e){ previousRanks = {}; }

// Î ÏÎ¿Î±Î¹ÏÎµÏ„Î¹ÎºÎ¬: map id->avatar URL. Î‘Î½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹, Î¸Î± Ï†Ï„Î¹Î¬Î¾Î¿Ï…Î¼Îµ initials avatar.
// --- Avatars (ÎµÎ¹ÎºÏŒÎ½ÎµÏ‚ Î® initials) ---
const AVATAR_MAP = JSON.parse(localStorage.getItem("avatarMap") || "{}");

function makeInitialAvatarDataURI(fullName = "") {
  const initials = (fullName || "?")
    .trim()
    .split(/\s+/)
    .slice(0,2)
    .map(s => s[0]?.toUpperCase() || "")
    .join("");

  // ÏƒÏ„Î±Î¸ÎµÏÎ® Î±Ï€ÏŒÏ‡ÏÏ‰ÏƒÎ· Î±Î½Î¬ ÏŒÎ½Î¿Î¼Î±
  let hash = 0;
  for (let i = 0; i < fullName.length; i++) hash = (hash * 31 + fullName.charCodeAt(i)) | 0;
  const hue = Math.abs(hash) % 360;

  const svg = `
    <svg xmlns='http://www.w3.org/2000/svg' width='128' height='128'>
      <defs>
        <linearGradient id='g' x1='0' y1='0' x2='1' y2='1'>
          <stop offset='0%' stop-color='hsl(${hue}, 75%, 62%)'/>
          <stop offset='100%' stop-color='hsl(${(hue+40)%360}, 85%, 58%)'/>
        </linearGradient>
      </defs>
      <rect width='100%' height='100%' fill='url(#g)'/>
      <text x='50%' y='54%' dominant-baseline='middle' text-anchor='middle'
            font-family='Poppins, Arial, sans-serif' font-size='56' fill='rgba(255,255,255,.95)'
            style='paint-order: stroke; stroke: rgba(0,0,0,.25); stroke-width: 3px;'>
        ${initials}
      </text>
    </svg>`;
  return "data:image/svg+xml;utf8," + encodeURIComponent(svg);
}

function getAvatarFor(id, name){
  const url = AVATAR_MAP[id];
  return url && typeof url === "string" ? url : makeInitialAvatarDataURI(name || "");
}
const CROWN_SVG = `
  <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
    <defs>
      <linearGradient id="cg" x1="0" y1="0" x2="1" y2="1">
        <stop offset="0%" stop-color="#fff3c4"/>
        <stop offset="60%" stop-color="#ffd166"/>
        <stop offset="100%" stop-color="#caa03a"/>
      </linearGradient>
    </defs>
    <path d="M8 46 L12 22 L24 34 L32 18 L40 34 L52 22 L56 46 Z" fill="url(#cg)"/>
    <rect x="10" y="44" width="44" height="6" rx="3" fill="rgba(0,0,0,.15)"/>
  </svg>`;
// --- Premium medal SVGs (gold/silver/bronze) ---
const MEDAL_HTML = {
  gold:   `<img class="xlb-medal" src="https://i.postimg.cc/3wBJs6Py/c04dfc75-e5b5-4af8-962a-666bc2da3e2a-removalai-preview.png" alt="1st medal">`,
  silver: `<img class="xlb-medal" src="https://i.postimg.cc/kGknNdtH/eea946d3-52a9-4678-b826-78cfbf35dcd0-removalai-preview.png" alt="2nd medal">`,
  bronze: `<img class="xlb-medal" src="https://i.postimg.cc/P5btD9f6/363de7da-8d9d-4460-9bbf-22c80b24c04e-removalai-preview.png" alt="3rd medal">`,
};
function fitLeaderboardToViewport(slideEl){
  const panel = slideEl.querySelector('.xlb-panel');
  if (!panel) return;

  // reset Ï€ÏÎ¹Î½ Î¼ÎµÏ„ÏÎ®ÏƒÎ¿Ï…Î¼Îµ
  panel.style.transform = 'none';
  panel.style.transformOrigin = 'center center';

  // Ï†Ï…ÏƒÎ¹ÎºÎ­Ï‚ (unscaled) Î´Î¹Î±ÏƒÏ„Î¬ÏƒÎµÎ¹Ï‚
  const naturalH = panel.scrollHeight;
  const naturalW = panel.scrollWidth;

  // Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ viewport
  const vh = window.innerHeight;
  const vw = window.innerWidth;

  // scale ÏÏƒÏ„Îµ Î½Î± Ï‡Ï‰ÏÎ¬ÎµÎ¹ ÎšÎ‘Î™ ÏƒÎµ ÏÏˆÎ¿Ï‚ ÎšÎ‘Î™ ÏƒÎµ Ï€Î»Î¬Ï„Î¿Ï‚
  const scaleH = vh / naturalH;
  const scaleW = vw / naturalW;
  const scale  = Math.min(scaleH, scaleW, 1); // Ï€Î¿Ï„Î­ >1 Î³Î¹Î± Î½Î± Î¼Î·Î½ â€œÎ¼ÎµÎ³Î±Î»ÏÎ½ÎµÎ¹â€ Î¸Î¿Î»Î¬

  panel.style.transform = `scale(${scale})`;
  // ÎºÎµÎ½Ï„ÏÎ¬ÏÎ¹ÏƒÎ¼Î± Î³Î¯Î½ÎµÏ„Î±Î¹ Î±Ï€ÏŒ .xlb-slide (flex center), Î´ÎµÎ½ Î²Î¬Î¶Î¿Ï…Î¼Îµ extra paddings ÎµÎ´Ï
}

let unsubLeaderboard = null;

function startRealtimeLeaderboard() {
  console.log("[LB] attach listener");
  const todayIso = new Date().toISOString().slice(0, 10);
  if (unsubLeaderboard) { unsubLeaderboard(); unsubLeaderboard = null; }

  unsubLeaderboard = db.collection('xgym_scans')
    .where('dateKey', '==', todayIso)
    .onSnapshot((snap) => {
      console.log("[LB] snapshot size:", snap.size);
      const map = new Map();
      snap.docs.forEach(d => {
        const data = d.data() || {};
        const name = String(data.name || '').trim();
        if (!name) return;
        map.set(name, (map.get(name) || 0) + 1);
      });

      const rows = Array.from(map.entries())
        .map(([name, count]) => ({ name, count }))
        .sort((a,b) => (b.count - a.count) || a.name.localeCompare(b.name, "el"))
        .slice(0, 10);

      console.log("[LB] rows:", rows);
      renderLeaderboardFromRows(rows);
    }, (err) => console.error('[LB] Firestore listener error:', err));
}
function renderLeaderboardFromRows(rows){
  const sc = document.querySelector(".slideshow-container");
  if (!sc) { console.error("[LB] .slideshow-container Î”Î•Î Î²ÏÎ­Î¸Î·ÎºÎµ!"); return; }

  // Î Î±Î»Î¹Î¬ leaderboard slide + ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ® Ï„Î·Ï‚
  const oldSlide = sc.querySelector(".leaderboard-slide");
  const wasActive = !!oldSlide && oldSlide.classList.contains("active");
  const oldIndex = oldSlide ? Array.from(sc.children).indexOf(oldSlide) : -1;
rows = rows.slice(0, 8); // ÎšÏÎ±Ï„Î¬ Î¼ÏŒÎ½Î¿ Ï„Î¿Ï…Ï‚ Ï€ÏÏÏ„Î¿Ï…Ï‚ 8
  // Î‘Î½ Î”Î•Î Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ rows, Î´ÎµÎ¯Î¾Îµ placeholder ÏƒÏ„Î·Î½ Î¯Î´Î¹Î± Î¸Î­ÏƒÎ·
  if (!rows || !rows.length) {
    const empty = document.createElement("div");
    empty.className = "slide leaderboard-slide xlb-slide";
    empty.innerHTML = `
      <div class="xlb-panel">
        <div class="xlb-head">
          <div class="xlb-kicker">MONTHLY â€¢ TOP 10</div>
          <div class="xlb-title">Leaderboard</div>
          <div class="xlb-underline"></div>
        </div>
        <div class="xlb-list">
          <div style="padding:24px;opacity:.75;text-align:center;">Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎºÎ±Ï„Î±Î³ÏÎ±Ï†Î­Ï‚ Î³Î¹Î± ÏƒÎ®Î¼ÎµÏÎ±.</div>
        </div>
      </div>`;
    if (oldIndex >= 0) {
      sc.insertBefore(empty, sc.children[oldIndex]);
      oldSlide.remove();
    } else {
      sc.appendChild(empty);
    }
    // Î±Î½Î±Î½Î­Ï‰ÏƒÎµ slides & active
    slides = document.querySelectorAll('.slide');
    if (wasActive) {
      slides.forEach(s => s.classList.remove('active'));
      empty.classList.add('active');
      currentSlide = oldIndex >= 0 ? oldIndex : Array.from(slides).indexOf(empty);
    }
    fitLeaderboardToViewport(empty);
    return;
  }

  // --- Î§Ï„Î¯ÏƒÎµ Ï„Î¿ Î½Î­Î¿ "Ï€Î»Î¿ÏÏƒÎ¹Î¿" slide ÏŒÏ€Ï‰Ï‚ Ï€ÏÎ¹Î½ ---
  const maxCount = Math.max(...rows.map(r => r.count));
  const newSlide = document.createElement("div");
  newSlide.className = "slide leaderboard-slide xlb-slide";

  const rowsHTML = rows.map((r, i) => {
    const rank = i + 1;
    const medalClass = i === 0 ? "gold" : i === 1 ? "silver" : i === 2 ? "bronze" : "";
    const isMedal = i < 3;
    const pct = maxCount ? Math.round((r.count / maxCount) * 100) : 0;

    const idKey = r.name;
    const prevRanks = JSON.parse(localStorage.getItem("previousRanks") || "{}");
    const deltaMemory = JSON.parse(localStorage.getItem("deltaMemory") || "{}");

    let delta = 0, deltaClass = "same", deltaText = "â€“";
    if (prevRanks[idKey] !== undefined) {
      delta = prevRanks[idKey] - i;
      if (delta > 0) { deltaClass = "up"; deltaText = "â‡§"+delta; }
      else if (delta < 0) { deltaClass = "down"; deltaText = "â‡©"+Math.abs(delta); }
    }
    if (delta === 0 && deltaMemory[idKey]) {
      const mem = deltaMemory[idKey];
      deltaClass = mem.dir === "up" ? "up" : mem.dir === "down" ? "down" : "same";
      deltaText  = mem.dir === "up" ? "â‡§"+(mem.step||1)
                 : mem.dir === "down" ? "â‡©"+(mem.step||1) : "â€“";
    } else if (delta !== 0) {
      deltaMemory[idKey] = { dir: delta>0 ? "up":"down", step: Math.abs(delta) };
    }

    const avatarUrl = getAvatarFor(idKey, r.name);
    const rankCell  = isMedal
      ? `<div class="xlb-rank">${MEDAL_HTML[medalClass]}</div>`
      : `<div class="xlb-rank">${rank}</div>`;

    const countCell = i === 0
      ? `<div class="xlb-count crown-wrapper">
           <span class="xlb-crown" aria-hidden="true">${(typeof CROWN_SVG === "string") ? CROWN_SVG : ""}</span>
           <span class="xlb-count-number">${r.count}</span>
         </div>`
      : `<div class="xlb-count">${r.count}</div>`;

    const extraFirst = i === 0 ? "xlb-first" : "";
    const rankAnimClass = delta > 0 ? "rank-up" : "";

    return `
      <div class="xlb-item ${extraFirst} ${isMedal ? "medal " + medalClass : ""} ${rankAnimClass}"
           data-rank="${rank}" style="--pct:${pct}">
        ${rankCell}
        <div class="xlb-avatar"><img src="${avatarUrl}" alt="avatar"></div>
        <div class="xlb-name">
          <span class="xlb-name-text">${r.name}</span>
          <span class="xlb-delta ${deltaClass}">${deltaText}</span>
        </div>
        ${countCell}
      </div>`;
  }).join("");

  newSlide.innerHTML = `
    <div class="xlb-panel">
      <div class="xlb-corners" aria-hidden="true">
        <span class="c tl"></span><span class="c tr"></span><span class="c bl"></span><span class="c br"></span>
      </div>
      <div class="xlb-head">
        <div class="xlb-kicker">ÎœÎ—ÎÎ™Î‘Î™ÎŸ â€¢ TOP 8 ÏƒÎµ Ï€ÏÎ¿Ï€Î¿Î½Î®ÏƒÎµÎ¹Ï‚</div>
        <div class="xlb-title-row">
          <div class="xlb-logo"><img src="https://i.postimg.cc/Y9HZXm3q/f26ceef4-3445-4c9a-a15d-64ea3cac2a95-removalai-preview.png" alt="logo left"></div>
          <div class="xlb-title">Leaderboard</div>
          <div class="xlb-logo"><img src="https://i.postimg.cc/Y9HZXm3q/f26ceef4-3445-4c9a-a15d-64ea3cac2a95-removalai-preview.png" alt="logo right"></div>
        </div>
        <div class="xlb-underline"></div>
      </div>
      <div class="xlb-list">${rowsHTML}</div>
    </div>
  `;

  // âœ Î’Î¬Î»Îµ Ï„Î· Î½Î­Î± slide ÏƒÏ„Î·Î½ Î¯Î´Î¹Î± Î¸Î­ÏƒÎ· Î¼Îµ Ï„Î·Î½ Ï€Î±Î»Î¹Î¬ (Î±Î½ Ï…Ï€Î®ÏÏ‡Îµ)
  if (oldIndex >= 0) {
    sc.insertBefore(newSlide, sc.children[oldIndex]);
    oldSlide.remove();
  } else {
    sc.appendChild(newSlide);
  }

  // âœ Î‘Î½Î±Î½ÎµÏÏƒÎµ Ï„Î¿ NodeList ÎºÎ±Î¹ Ï„Î¿ active
  slides = document.querySelectorAll('.slide');
  if (wasActive) {
    slides.forEach(s => s.classList.remove('active'));
    newSlide.classList.add('active');
    currentSlide = oldIndex >= 0 ? oldIndex : Array.from(slides).indexOf(newSlide);
  }

  // âœ Î•ÎÎ•Î¡Î“ÎŸÎ ÎŸÎ™Î—Î£Î— ROWS (animation + Î¿ÏÎ±Ï„ÏŒÏ„Î·Ï„Î±)
requestAnimationFrame(() => {
  const items = newSlide.querySelectorAll(".xlb-item");
  items.forEach((row, idx) => {
    row.style.setProperty("--d", `${idx * 70}ms`);
    row.classList.add("in");            // â¬…ï¸ Î§Ï‰ÏÎ¯Ï‚ Î±Ï…Ï„ÏŒ Î¼Î­Î½Î¿Ï…Î½ â€œÎ±ÏŒÏÎ±Ï„Î±â€
  });
  if (typeof retriggerRankAnims === "function") retriggerRankAnims(newSlide);
});

  // fit + anims
  fitLeaderboardToViewport(newSlide);
  requestAnimationFrame(()=>fitLeaderboardToViewport(newSlide));
  setTimeout(()=>fitLeaderboardToViewport(newSlide), 300);
  setTimeout(()=>fitLeaderboardToViewport(newSlide), 800);

  newSlide.querySelectorAll('img').forEach(img=>{
    if(!img.complete){ img.addEventListener('load', ()=>fitLeaderboardToViewport(newSlide), {once:true}); }
  });

  // persist ranks Î³Î¹Î± ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿ render
  const newRanks = {};
  rows.forEach((r, i) => { newRanks[r.name] = i; });
  localStorage.setItem("previousRanks", JSON.stringify(newRanks));
}

function populateLeaderboard() {
  // 1) ÎšÎ±Î¸Î¬ÏÎ¹ÏƒÎµ Ï€Î±Î»Î¹ÏŒ slide
  const old = document.querySelector(".leaderboard-slide");
  if (old) old.remove();

  // 2) Î”ÎµÎ´Î¿Î¼Î­Î½Î± & Ï„Î±Î¾Î¹Î½ÏŒÎ¼Î·ÏƒÎ·
  const counts = getMonthlyCounts();
  const sorted = Object.entries(counts)
    .sort((a, b) => (b[1].count - a[1].count) || a[1].name.localeCompare(b[1].name, "el"))
    .slice(0, 10);

  // 3) previousRanks & deltaMemory (Ï‡Ï‰ÏÎ¯Ï‚ refresh)
  const lsPrev = JSON.parse(localStorage.getItem("previousRanks") || "{}");
  const prevRanksRaw = (typeof window.previousRanks === "object" && window.previousRanks) ? window.previousRanks : lsPrev;
  const prevRanks = {};
  Object.keys(prevRanksRaw).forEach(k => { prevRanks[String(k)] = prevRanksRaw[k]; });

  const deltaMemoryRaw = JSON.parse(localStorage.getItem("deltaMemory") || "{}");
  const deltaMemory = {};
  Object.keys(deltaMemoryRaw).forEach(k => { deltaMemory[String(k)] = deltaMemoryRaw[k]; });

  // 4) ÎÎ­ÎµÏ‚ Î¸Î­ÏƒÎµÎ¹Ï‚
  const newRanks = {};
  sorted.forEach(([id], i) => { newRanks[String(id)] = i; });

  // 5) Max Î³Î¹Î± progress
  const maxCount = sorted.length ? Math.max(...sorted.map(([_, v]) => v.count)) : 1;

  // 6) Slide wrapper
  const slide = document.createElement("div");
  slide.className = "slide leaderboard-slide xlb-slide";

  // 7) Rows
  const rowsHTML = sorted.map(([id, info], i) => {
    const idKey = String(id);
    const rank = i + 1;
    const medalClass = i === 0 ? "gold" : i === 1 ? "silver" : i === 2 ? "bronze" : "";
    const isMedal = i < 3;
    const pct = maxCount ? Math.round((info.count / maxCount) * 100) : 0;

    // Î”ÎµÎ¯ÎºÏ„ÎµÏ‚ Î±Î½ÏŒÎ´Î¿Ï…/Ï€Ï„ÏÏƒÎ·Ï‚
    let delta = 0, deltaClass = "same", deltaText = "â€“";
    if (prevRanks[idKey] !== undefined) {
      delta = prevRanks[idKey] - newRanks[idKey]; // >0 = Î±Î½Î­Î²Î·ÎºÎµ
      if (delta > 0) { deltaClass = "up";   deltaText = "â‡§" + delta; }
      else if (delta < 0) { deltaClass = "down"; deltaText = "â‡©" + Math.abs(delta); }
    }

    // ÎœÎ½Î®Î¼Î· Î³Î¹Î± Î½Î± Î¼Î­Î½ÎµÎ¹ Ï„Î¿ Î²ÎµÎ»Î¬ÎºÎ¹ Î¼Î­Ï‡ÏÎ¹ Ï„Î·Î½ ÎµÏ€ÏŒÎ¼ÎµÎ½Î· Î±Î»Î»Î±Î³Î®
    if (delta === 0) {
      const mem = deltaMemory[idKey];
      if (mem && mem.dir) {
        deltaClass = mem.dir === "up" ? "up" : mem.dir === "down" ? "down" : "same";
        deltaText  = mem.dir === "up" ? "â‡§" + (mem.step || 1)
                   : mem.dir === "down" ? "â‡©" + (mem.step || 1)
                   : "â€“";
      }
    } else {
      deltaMemory[idKey] = { dir: delta > 0 ? "up" : "down", step: Math.abs(delta) };
    }

    const avatarUrl = getAvatarFor(idKey, info.name);
 const rankCell  = isMedal
  ? `<div class="xlb-rank">${MEDAL_HTML[medalClass]}</div>`
  : `<div class="xlb-rank">${rank}</div>`;

    // ÎšÎ¿ÏÏŒÎ½Î± Ï€Î¬Î½Ï‰ Î±Ï€ÏŒ Ï„Î¿ count ÎœÎŸÎÎŸ Î³Î¹Î± Ï„Î¿Î½ Ï€ÏÏÏ„Î¿
    const countCell = i === 0
      ? `<div class="xlb-count crown-wrapper">
           <span class="xlb-crown" aria-hidden="true">${(typeof CROWN_SVG === "string") ? CROWN_SVG : ""}</span>
           <span class="xlb-count-number">${info.count}</span>
         </div>`
      : `<div class="xlb-count">${info.count}</div>`;

    const extraFirst = i === 0 ? "xlb-first" : "";
    const rankAnimClass = delta > 0 ? "rank-up" : "";

    return `
      <div class="xlb-item ${extraFirst} ${isMedal ? "medal " + medalClass : ""} ${rankAnimClass}"
           data-rank="${rank}" style="--pct:${pct}">
        ${rankCell}
        <div class="xlb-avatar"><img src="${avatarUrl}" alt="avatar"></div>
        <div class="xlb-name">
          <span class="xlb-name-text">${info.name}</span>
          <span class="xlb-delta ${deltaClass}">${deltaText}</span>
        </div>
        ${countCell}
      </div>
    `;
  }).join("");

  // 8) Panel
slide.innerHTML = `
  <div class="xlb-panel">
    <div class="xlb-corners" aria-hidden="true">
      <span class="c tl"></span>
      <span class="c tr"></span>
      <span class="c bl"></span>
      <span class="c br"></span>
    </div>

    <div class="xlb-head">
      <div class="xlb-kicker">MONTHLY â€¢ TOP 10 ÏƒÎµ Ï€ÏÎ¿Ï€Î¿Î½Î®ÏƒÎµÎ¹Ï‚</div>

      <!-- ÎÎ•ÎŸ row: logo â€“ title â€“ logo -->
      <div class="xlb-title-row">
        <div class="xlb-logo">
          <img src="https://i.postimg.cc/Y9HZXm3q/f26ceef4-3445-4c9a-a15d-64ea3cac2a95-removalai-preview.png" alt="logo left">
        </div>

        <div class="xlb-title">Leaderboard</div>

        <div class="xlb-logo">
          <img src="https://i.postimg.cc/Y9HZXm3q/f26ceef4-3445-4c9a-a15d-64ea3cac2a95-removalai-preview.png" alt="logo right">
        </div>
      </div>

      <div class="xlb-underline"></div>
    </div>

    <div class="xlb-list">${rowsHTML}</div>
  </div>
`;

  // 9) Mount
  document.querySelector(".slideshow-container").appendChild(slide);

  // 9a) Fit: Î±ÏÏ‡Î¹ÎºÏŒ + ÎµÏ€Î±Î½Î±Î»Î·Ï€Ï„Î¹ÎºÎ¬ (Î³Î¹Î± stagger, avatars, webfonts)
  fitLeaderboardToViewport(slide);
  requestAnimationFrame(() => fitLeaderboardToViewport(slide));
  setTimeout(() => fitLeaderboardToViewport(slide), 300);
  setTimeout(() => fitLeaderboardToViewport(slide), 800);

  // Refit ÏŒÏ„Î±Î½ Ï†Î¿ÏÏ„ÏÏƒÎ¿Ï…Î½ Î¿Î¹ ÎµÎ¹ÎºÏŒÎ½ÎµÏ‚ (avatars)
  slide.querySelectorAll('img').forEach(img => {
    if (!img.complete) {
      img.addEventListener('load', () => fitLeaderboardToViewport(slide), { once:true });
    }
  });

  // Refit ÏƒÎµ Ï€ÏÎ±Î³Î¼Î±Ï„Î¹ÎºÎ­Ï‚ Î±Î»Î»Î±Î³Î­Ï‚ ÏÏˆÎ¿Ï…Ï‚ (animations/deltas ÎºÎ»Ï€)
  const ro = new ResizeObserver(() => fitLeaderboardToViewport(slide));
  const panelEl = slide.querySelector('.xlb-panel');
  if (panelEl) ro.observe(panelEl);

  // Refit Î±Î½ Î±Î»Î»Î¬Î¾ÎµÎ¹ Ï„Î¿ Î¼Î­Î³ÎµÎ¸Î¿Ï‚ Ï€Î±ÏÎ±Î¸ÏÏÎ¿Ï…/TV
  const onResizeFit = () => fitLeaderboardToViewport(slide);
  window.addEventListener('resize', onResizeFit, { passive: true });

  // 10) Î•Î¯ÏƒÎ¿Î´Î¿Ï‚ + retrigger rank anims
  requestAnimationFrame(() => {
    const items = slide.querySelectorAll(".xlb-item");
    void slide.offsetHeight; // force reflow
    items.forEach((row, idx) => {
      row.style.setProperty("--d", `${idx * 70}ms`);
      row.classList.add("in");
    });
    if (typeof retriggerRankAnims === "function") retriggerRankAnims(slide);
  });

  // 11) Persist
  Promise.resolve().then(() => {
    window.previousRanks = newRanks;
    localStorage.setItem("previousRanks", JSON.stringify(newRanks));
    localStorage.setItem("deltaMemory", JSON.stringify(deltaMemory));
  });
}
// === Instant loading overlay ===
function showLoadingPopup() {
  let el = document.getElementById("popup-loading");
  if (el) return el; // Î¼Î·Î½ Ï„Î¿ Î¾Î±Î½Î±ÏƒÏ„Î®Î½ÎµÎ¹Ï‚

  el = document.createElement("div");
  el.id = "popup-loading";
  el.innerHTML = `
    <div class="loading-card">
      <div class="loading-inner">

        <!-- ğŸ‘‡ ÎšÎ¥ÎšÎ›Î™ÎšÎŸ LOGO ÎœÎ• ANIMATION -->
        <div class="holo-logo">
          <img
            src="https://i.postimg.cc/Y9HZXm3q/f26ceef4-3445-4c9a-a15d-64ea3cac2a95-removalai-preview.png"  /* Î²Î¬Î»Îµ ÏƒÏ‰ÏƒÏ„ÏŒ path */
            alt="Lion logo"
            width="200" height="200"
            decoding="async" loading="eager"
          />
        </div>

        <div class="loading-title">
  ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ ÏƒÏ…Î½Î´ÏÎ¿Î¼Î®Ï‚
</div>
        <div class="loading-sub">Î Î±ÏÎ±ÎºÎ±Î»Ï Ï€ÎµÏÎ¹Î¼Î­Î½ÎµÏ„Îµ</div>
        <div class="loading-progress">
          <div class="loading-bar"></div>
        </div>
      </div>
    </div>
  `;
  document.body.appendChild(el);
  return el;
}

function hideLoadingPopup() {
  const el = document.getElementById("popup-loading");
  if (!el) return;
  el.classList.add("hide");
  setTimeout(() => el.remove(), 300);
}

    // Subscription check
    // Subscription check
async function checkSubscriptionForId(scannedId) {
  if (!scannedId) return;

  const loading = showLoadingPopup();

  try {
    const response = await fetch(
      "https://script.google.com/macros/s/AKfycbzxFrrfTz9LGux2WxNJGdxAabKC5ca9fPNSYNLTejyMrVn2qCljaFb4_nPoNmSrE1TzUQ/exec?id=" + encodeURIComponent(scannedId),
      { cache: "no-store" }
    );

    const data = await response.json();
    hideLoadingPopup();

    // Î Î‘ÎÎ¤Î‘ Î±Ï€ÏŒ Sheet
    const sheetName = String(data.name || "").trim();
    const firstOnly = sheetName.split(/\s+/)[0] || "";
    const displayedName = formatName(firstOnly); // Î® Î²Î¬Î»Îµ ÎºÎ±Ï„ÎµÏ…Î¸ÎµÎ¯Î±Î½ firstOnly Î±Î½ Î´ÎµÎ½ Î¸ÎµÏ‚ vocative

    showPopup(displayedName, !!data.active);
  } catch (error) {
    console.error("âŒ Î£Ï†Î¬Î»Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î¿ fetch:", error);
    hideLoadingPopup();
    showPopup("âš ï¸ Î£Ï†Î¬Î»Î¼Î±", false);
  }
}

function updateClock() {
  const now = new Date();
  let hours = now.getHours();           // âœ… 24Ï‰ÏÎ¿, Ï‡Ï‰ÏÎ¯Ï‚ Î¼ÎµÏ„Î±Ï„ÏÎ¿Ï€Î®
  const minutes = now.getMinutes();

  const hoursStr = hours.toString().padStart(2, "0");
  const minutesStr = minutes.toString().padStart(2, "0");

  const time = `${hoursStr}:${minutesStr}`;  // âœ… Î§Ï‰ÏÎ¯Ï‚ AM/PM
  document.getElementById("digitalClock").textContent = time;
}

setInterval(updateClock, 10000); // Î±Î½Î±Î½Î­Ï‰ÏƒÎ· ÎºÎ¬Î¸Îµ 10 Î´ÎµÏ…Ï„ÎµÏÏŒÎ»ÎµÏ€Ï„Î±
updateClock(); // Î±ÏÏ‡Î¹ÎºÎ® ÎµÎ¼Ï†Î¬Î½Î¹ÏƒÎ·


  </script>
</body>
</html>
